<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>肯德基自助点餐系统</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
		<!-- 在 font-awesome 链接后添加 -->
		<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.2/dist/av-min.js"></script>
		<style>
			/* 所有CSS样式保持不变 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f8f8f8;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #e31837 0%, #c8102e 100%);
            color: white;
            padding: 25px 0;
            text-align: center;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 2.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .logo i {
            color: #ffcc00;
        }
        
        .header-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }
        
        .info-item i {
            color: #ffcc00;
        }
        
        .header-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .header-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .header-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .nav-menu {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .nav-title {
            font-size: 1.6rem;
            color: #e31837;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .meal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .meal-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            border-left: 5px solid #ffcc00;
            display: block;
            text-decoration: none;
            color: inherit;
        }
        
        .meal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .meal-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #e31837;
        }
        
        .meal-price {
            font-size: 1.6rem;
            font-weight: bold;
            color: #e31837;
        }
        
        .meal-description {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .meal-tag {
            display: inline-block;
            background-color: #ffcc00;
            color: #333;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 8px;
            margin-bottom: 5px;
        }
        
        .back-btn {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            margin-bottom: 20px;
            text-decoration: none;
            width: fit-content;
        }
        
        .back-btn:hover {
            background-color: #c8102e;
            transform: scale(1.03);
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }
        
        .menu-section {
            flex: 3;
            min-width: 300px;
        }
        
        .cart-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .section-title {
            font-size: 1.8rem;
            color: #e31837;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #ffcc00;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #ffcc00;
        }
        
        .meal-options {
            margin-bottom: 30px;
        }
        
        .option-group {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #e31837;
        }
        
        .option-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #444;
            font-size: 1.1rem;
        }
        
        .option-rules {
            font-size: 0.9rem;
            color: #e31837;
            margin-bottom: 10px;
            padding: 5px 10px;
            background-color: #ffe6e6;
            border-radius: 4px;
            display: inline-block;
        }
        
        .option-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .option-item {
            background-color: #f5f5f5;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.95rem;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 180px;
            position: relative;
        }
        
        .option-item:hover {
            background-color: #e9e9e9;
        }
        
        .option-item.selected {
            background-color: #e31837;
            color: white;
            border-color: #e31837;
        }
        
        .selection-counter {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }
        
        .counter-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            background-color: white;
            color: #e31837;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .counter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .counter-value {
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }
        
        .add-to-cart {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            width: 100%;
            justify-content: center;
        }
        
        .add-to-cart:hover {
            background-color: #c8102e;
            transform: scale(1.03);
        }
        
        .add-to-cart:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-name {
            flex: 2;
            font-weight: 500;
        }
        
        .cart-item-price {
            flex: 1;
            text-align: right;
            font-weight: bold;
            color: #e31837;
        }
        
        .cart-item-remove {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 10px;
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #eee;
        }
        
        .total-price {
            color: #e31837;
        }
        
        .checkout-btn {
            background-color: #ffcc00;
            color: #333;
            border: none;
            padding: 15px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .checkout-btn:hover {
            background-color: #e6b800;
            transform: scale(1.03);
        }
        
        .checkout-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .delivery-form {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .required {
            color: #e31837;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #e31837;
            box-shadow: 0 0 0 2px rgba(227, 24, 55, 0.2);
        }
        
        .order-type {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .order-type label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }
        
        .order-type label:hover {
            border-color: #e31837;
        }
        
        .order-type input:checked + span {
            font-weight: bold;
            color: #e31837;
        }
        
        .delivery-fields, .pickup-fields {
            transition: all 0.3s;
        }
        
        .hidden {
            display: none;
        }
        
        .store-selection {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .store-selection .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .info-method-selector {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .method-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .method-option:hover {
            border-color: #e31837;
            background-color: #fff5f5;
        }
        
        .method-option input:checked + span {
            font-weight: bold;
            color: #e31837;
        }
        
        .method-option input:checked {
            accent-color: #e31837;
        }
        
        .screenshot-upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }
        
        .screenshot-upload-area:hover {
            border-color: #e31837;
            background-color: #fff5f5;
        }
        
        .screenshot-upload-area i {
            font-size: 48px;
            color: #e31837;
            margin-bottom: 10px;
        }
        
        .upload-hint {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .screenshot-preview {
            position: relative;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #f9f9f9;
            max-width: 300px;
        }
        
        .screenshot-preview img {
            width: 100%;
            border-radius: 5px;
            display: block;
            max-height: 200px;
            object-fit: contain;
        }
        
        .remove-screenshot {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e31837;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-hint {
            font-size: 0.9rem;
            color: #666;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .form-hint i {
            color: #ffcc00;
        }
        
        .instructions {
            font-size: 0.9rem;
            color: #666;
            margin-top: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #ffcc00;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
        }
        
        .highlight {
            color: #e31837;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: #fff5f5;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #ffcc00;
        }
        
        .highlight i {
            color: #ffcc00;
        }
        
        .selection-status {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
            padding: 5px 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            display: inline-block;
        }
        
        .selection-status.valid {
            background-color: #e6f7e6;
            color: #2e7d32;
        }
        
        .selection-status.invalid {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .fixed-combo-items {
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .fixed-combo-item {
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .fixed-combo-item:last-child {
            border-bottom: none;
        }
        
        .fixed-combo-item-name {
            font-weight: 500;
        }
        
        .fixed-combo-item-qty {
            color: #e31837;
            font-weight: bold;
        }
        
        .my-orders-section {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .orders-search {
            margin-bottom: 20px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .search-btn {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background-color: #c8102e;
        }
        
        .order-filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .order-filter-tab {
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .order-filter-tab:hover {
            background-color: #e0e0e0;
        }
        
        .order-filter-tab.active {
            background-color: #e31837;
            color: white;
        }
        
        .user-order-item {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #ffcc00;
        }
        
        .user-order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .user-order-id {
            font-weight: bold;
            color: #333;
            font-size: 1.2rem;
        }
        
        .user-order-time {
            color: #666;
            font-size: 0.95rem;
        }
        
        .user-order-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .user-status-new {
            background-color: #ffebee;
            color: #e31837;
        }
        
        .user-status-processing {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .user-status-completed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .user-order-items {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .user-order-item-detail {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dashed #eee;
        }
        
        .user-order-item-detail:last-child {
            border-bottom: none;
        }
        
        .user-order-item-name {
            flex: 2;
        }
        
        .user-order-item-price {
            flex: 1;
            text-align: right;
            font-weight: bold;
            color: #e31837;
        }
        
        .user-order-info {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .user-order-info p {
            margin-bottom: 5px;
        }
        
        .user-order-total {
            font-weight: bold;
            color: #e31837;
            font-size: 1.2rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #eee;
            text-align: right;
        }
        
        .no-user-orders {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .no-user-orders i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        .user-id-info {
            background-color: #f0f0f0;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-id-label {
            font-weight: bold;
            color: #666;
        }
        
        .user-id-value {
            font-family: monospace;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .admin-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 1200px;
            height: 100vh;
            background-color: white;
            z-index: 2000;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
            display: none;
        }
        
        .admin-panel.active {
            transform: translateX(0);
            display: block;
        }
        
        .panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            display: none;
        }
        
        .panel-overlay.active {
            display: block;
        }
        
        .panel-header {
            background: linear-gradient(135deg, #e31837 0%, #c8102e 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .panel-header h2 {
            font-size: 1.8rem;
            margin: 0;
        }
        
        .close-panel {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s;
        }
        
        .close-panel:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .panel-content {
            padding: 20px;
        }
        
        .admin-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            color: #666;
            font-weight: 500;
        }
        
        .admin-tab:hover {
            color: #e31837;
            background-color: #fff5f5;
        }
        
        .admin-tab.active {
            color: #e31837;
            border-bottom-color: #e31837;
            font-weight: bold;
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .order-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            background-color: #e0e0e0;
        }
        
        .filter-btn.active {
            background-color: #e31837;
            color: white;
        }
        
        .orders-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            min-height: 300px;
        }
        
        .admin-order-item {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #ffcc00;
            transition: all 0.3s;
        }
        
        .admin-order-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .order-id {
            font-weight: bold;
            color: #333;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .order-time {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .order-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .status-new {
            background-color: #ffebee;
            color: #e31837;
        }
        
        .status-processing {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .status-completed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .order-details {
            margin-bottom: 15px;
        }
        
        .order-items {
            margin-bottom: 10px;
        }
        
        .order-item-detail {
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .order-total {
            font-weight: bold;
            color: #e31837;
            font-size: 1.2rem;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #eee;
        }
        
        .customer-info {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .customer-info p {
            margin-bottom: 5px;
        }
        
        .screenshot-container {
            margin-top: 15px;
        }
        
        .screenshot-container img {
            width: 100%;
            border-radius: 8px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .screenshot-container img:hover {
            transform: scale(1.02);
        }
        
        .no-orders {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            grid-column: 1 / -1;
            width: 100%;
        }
        
        .no-orders i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        .admin-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .admin-btn:hover {
            background-color: #555;
            transform: scale(1.05);
        }
        
        .new-order-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #e31837;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .image-modal.active {
            display: flex;
        }
        
        .modal-image {
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 3rem;
            cursor: pointer;
        }
        
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .password-modal.active {
            display: flex;
        }
        
        .password-box {
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        .password-box h3 {
            color: #e31837;
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .password-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 3px;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #e31837;
            box-shadow: 0 0 0 3px rgba(227, 24, 55, 0.2);
        }
        
        .password-btn {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .password-btn:hover {
            background-color: #c8102e;
            transform: scale(1.03);
        }
        
        .password-error {
            color: #e31837;
            margin-top: 15px;
            font-weight: bold;
            display: none;
        }
        
        .meal-page-container {
            display: none;
        }
        
        .meal-page-container.active {
            display: block;
        }
        
        .meal-management {
            margin-top: 20px;
        }
        
        .meal-list {
            margin-bottom: 30px;
        }
        
        .meal-list-item {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #e31837;
        }
        
        .meal-list-item-info {
            flex: 1;
        }
        
        .meal-list-item-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .edit-btn {
            background-color: #ffcc00;
            color: #333;
        }
        
        .edit-btn:hover {
            background-color: #e6b800;
        }
        
        .delete-btn {
            background-color: #e31837;
            color: white;
        }
        
        .delete-btn:hover {
            background-color: #c8102e;
        }
        
        .add-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .add-btn:hover {
            background-color: #3d8b40;
        }
        
        .meal-form {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .option-groups-management {
            margin-top: 30px;
        }
        
        .option-group-item {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .option-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .option-group-title {
            font-weight: bold;
            color: #333;
            font-size: 1.1rem;
        }
        
        .option-items-list {
            margin-top: 10px;
            padding-left: 20px;
        }
        
        .option-item-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .option-item-list-item:last-child {
            border-bottom: none;
        }
        
        .no-meals-message {
            text-align: center;
            padding: 30px;
            color: #666;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 2px dashed #ddd;
        }
        
        .no-meals-message i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        .fixed-items-management {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .fixed-item-list {
            margin-top: 10px;
        }
        
        .fixed-item-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .fixed-item-list-item:last-child {
            border-bottom: none;
        }
        
        .status-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .status-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .status-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .status-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .status-slider {
            background-color: #4CAF50;
        }
        
        input:checked + .status-slider:before {
            transform: translateX(30px);
        }
        
        .status-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 15px;
        }
        
        .status-active {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .status-inactive {
            color: #f44336;
            font-weight: bold;
        }
        
        .meal-card.inactive {
            opacity: 0.6;
            border-left: 5px solid #ccc;
            position: relative;
        }
        
        .meal-card.inactive:after {
            content: "已下架";
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f44336;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .meal-card.inactive:hover {
            transform: none;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
            cursor: not-allowed;
        }
        
        .meal-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .meal-filter-btn {
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .meal-filter-btn:hover {
            background-color: #e0e0e0;
        }
        
        .meal-filter-btn.active {
            background-color: #e31837;
            color: white;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .cart-section {
                position: static;
            }
            
            .logo {
                font-size: 2rem;
            }
            
            .meal-card {
                padding: 15px;
            }
            
            .store-selection {
                flex-direction: column;
            }
            
            .store-selection .form-group {
                min-width: 100%;
            }
            
            .info-method-selector {
                flex-direction: column;
            }
            
            .admin-panel {
                width: 100%;
            }
            
            .orders-container {
                grid-template-columns: 1fr;
            }
            
            .admin-btn span {
                display: none;
            }
            
            .admin-btn {
                padding: 15px;
                border-radius: 50%;
                width: 60px;
                height: 60px;
                justify-content: center;
            }
            
            .option-items {
                flex-direction: column;
            }
            
            .option-item {
                min-width: 100%;
                justify-content: space-between;
            }
            
            .password-box {
                padding: 25px;
                width: 95%;
            }
            
            .meal-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-row .form-group {
                min-width: 100%;
            }
            
            .meal-list-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .meal-list-item-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .option-group-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .header-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .header-btn {
                width: 200px;
                justify-content: center;
            }
        }
    </style>
	</head>
	<body>
		<header>
			<div class="container">
				<div class="logo">
					<i class="fas fa-utensils"></i>
					<h1>肯德基自助点餐系统</h1>
					<i class="fas fa-hamburger"></i>
				</div>
				<p>宅急送免配送费 | 多人餐团餐优惠 | 外送到家</p>
				<div class="header-info">
					<div class="info-item">
						<i class="fas fa-shipping-fast"></i>
						<span>宅急送免配送费</span>
					</div>
					<div class="info-item">
						<i class="fas fa-users"></i>
						<span>多人餐团餐优惠</span>
					</div>
					<div class="info-item">
						<i class="fas fa-store"></i>
						<span>到店自提</span>
					</div>
				</div>

				<div class="header-buttons">
					<button class="header-btn" id="viewOrdersBtn">
						<i class="fas fa-clipboard-list"></i>
						查看我的订单
					</button>
					<button class="header-btn" id="viewHomeBtn" style="display: none;">
						<i class="fas fa-home"></i>
						返回首页
					</button>
				</div>
			</div>
		</header>

		<div class="container">
			<div id="homePage" class="meal-page-container active">
				<div class="nav-menu">
					<h2 class="nav-title">
						<i class="fas fa-utensils"></i>
						选择您想要的套餐
					</h2>
					<div class="instructions">
						<p><strong>下单步骤：</strong></p>
						<ol>
							<li>选择您想要的套餐</li>
							<li>在套餐中选择具体的汉堡、小吃和饮品（点击选项，使用+/-按钮调整数量）</li>
							<li>确保每个选项组的选择数量符合要求（会有提示）</li>
							<li>点击"加入购物车"按钮</li>
							<li>在右侧购物车确认订单并选择配送方式</li>
							<li>提交订单完成购买</li>
							<li>提交后可以点击上方"查看我的订单"查看订单状态</li>
						</ol>
					</div>
				</div>

				<div class="meal-grid" id="mealGrid">
				</div>

				<div class="no-meals-message" id="noMealsMessage" style="display: none;">
					<i class="fas fa-utensils"></i>
					<h3>暂无套餐</h3>
					<p>请联系管理员添加套餐</p>
				</div>
			</div>

			<div id="mealDetailPage" class="meal-page-container">
			</div>

			<div id="myOrdersPage" class="meal-page-container">
				<a href="#" class="back-btn" onclick="showPage('homePage')">
					<i class="fas fa-arrow-left"></i>
					返回套餐列表
				</a>

				<div class="my-orders-section">
					<h2 class="section-title">
						<i class="fas fa-clipboard-list"></i>
						我的订单
					</h2>

					<div class="user-id-info">
						<div class="user-id-label">您的用户标识符：</div>
						<div class="user-id-value" id="currentUserIdDisplay"></div>
					</div>

					<div class="orders-search">
						<div class="search-box">
							<input type="text" class="search-input" id="orderSearchInput" placeholder="输入订单号搜索...">
							<button class="search-btn" id="orderSearchBtn">搜索</button>
						</div>

						<div class="order-filter-tabs">
							<button class="order-filter-tab active" data-order-filter="all">全部订单</button>
							<button class="order-filter-tab" data-order-filter="new">新订单</button>
							<button class="order-filter-tab" data-order-filter="processing">处理中</button>
							<button class="order-filter-tab" data-order-filter="completed">已完成</button>
						</div>
					</div>

					<div id="myOrdersContainer">
					</div>

					<div class="no-user-orders" id="noUserOrdersMessage">
						<i class="fas fa-box-open"></i>
						<h3>暂无订单</h3>
						<p>您还没有提交过订单，快去下单吧！</p>
					</div>
				</div>
			</div>

			<div class="footer">
				<p>© 2023 肯德基自助点餐系统 | 宅急送免配送费 | 商品特殊售出不退不换</p>
				<p>#春日出游必备 #吃鸡神器</p>
			</div>
		</div>

		<button class="admin-btn" id="adminBtn">
			<i class="fas fa-user-shield"></i>
			<span>后台管理</span>
			<div class="new-order-badge" id="newOrderBadge" style="display: none;">0</div>
		</button>

		<div class="password-modal" id="passwordModal">
			<div class="password-box">
				<h3><i class="fas fa-lock"></i> 管理员登录</h3>
				<input type="password" class="password-input" id="adminPassword" placeholder="请输入管理员密码" maxlength="6">
				<div class="password-error" id="passwordError">密码错误，请重新输入！</div>
				<button class="password-btn" id="submitPassword">确认</button>
			</div>
		</div>

		<div class="panel-overlay" id="panelOverlay"></div>
		<div class="admin-panel" id="adminPanel">
			<div class="panel-header">
				<h2><i class="fas fa-clipboard-list"></i> 系统管理后台</h2>
				<button class="close-panel" id="closePanel">
					<i class="fas fa-times"></i>
				</button>
			</div>

			<div class="panel-content">
				<div class="admin-tabs">
					<button class="admin-tab active" data-tab="orders">订单管理</button>
					<button class="admin-tab" data-tab="meals">套餐管理</button>
					<button class="admin-tab" data-tab="addMeal">添加套餐</button>
				</div>

				<div id="ordersTab" class="admin-tab-content active">
					<div class="order-filters">
						<button class="filter-btn active" data-filter="all">全部订单</button>
						<button class="filter-btn" data-filter="new">新订单</button>
						<button class="filter-btn" data-filter="processing">处理中</button>
						<button class="filter-btn" data-filter="completed">已完成</button>
						<button class="filter-btn" id="clearAllOrders">清空所有订单</button>
					</div>

					<div class="orders-container" id="ordersContainer">
						<div class="no-orders" id="noOrdersMessage">
							<i class="fas fa-box-open"></i>
							<h3>暂无订单</h3>
							<p>当顾客提交订单后，订单将显示在这里</p>
						</div>
					</div>
				</div>

				<div id="mealsTab" class="admin-tab-content">
					<div class="meal-filters">
						<button class="meal-filter-btn active" data-meal-filter="all">全部套餐</button>
						<button class="meal-filter-btn" data-meal-filter="active">已上架</button>
						<button class="meal-filter-btn" data-meal-filter="inactive">已下架</button>
					</div>

					<div class="meal-list" id="mealList">
					</div>
					<div class="no-meals-message" id="noMealsAdminMessage">
						<i class="fas fa-utensils"></i>
						<h3>暂无套餐</h3>
						<p>点击"添加套餐"标签创建新套餐</p>
					</div>
				</div>

				<div id="addMealTab" class="admin-tab-content">
					<h3 class="section-title" id="addMealTitle">
						<i class="fas fa-plus-circle"></i>
						添加新套餐
					</h3>

					<div class="meal-form">
						<input type="hidden" id="currentMealId" value="">

						<div class="form-row">
							<div class="form-group">
								<label class="form-label">套餐名称 <span class="required">*</span></label>
								<input type="text" class="form-input" id="mealName" placeholder="例如：【12-8】自提/宅急送12件套89.9元" required>
							</div>

							<div class="form-group">
								<label class="form-label">套餐价格 <span class="required">*</span></label>
								<input type="number" class="form-input" id="mealPrice" placeholder="例如：89.9" min="0" step="0.01" required>
							</div>
						</div>

						<div class="form-row">
							<div class="form-group">
								<label class="form-label">套餐标签 <span class="required">*</span></label>
								<input type="text" class="form-input" id="mealTags" placeholder="用逗号分隔，例如：自提/宅急送,3人餐,12件套" required>
								<div class="form-hint">
									<i class="fas fa-lightbulb"></i> 标签将显示在套餐卡片上，用逗号分隔多个标签
								</div>
							</div>

							<div class="form-group">
								<label class="form-label">套餐描述 <span class="required">*</span></label>
								<input type="text" class="form-input" id="mealDescription" placeholder="例如：适合3人享用，自提/宅急送都可用" required>
							</div>
						</div>

						<div class="form-row">
							<div class="form-group">
								<label class="form-label">套餐状态</label>
								<div class="status-label">
									<label class="status-toggle">
										<input type="checkbox" id="mealActive" checked>
										<span class="status-slider"></span>
									</label>
									<span id="statusText" class="status-active">上架</span>
								</div>
								<div class="form-hint">
									<i class="fas fa-lightbulb"></i> 上架的套餐会在用户端显示，下架的套餐不会显示
								</div>
							</div>
						</div>

						<h4 class="section-title" style="margin-top: 30px; font-size: 1.4rem;">
							<i class="fas fa-list"></i>
							选项组管理
						</h4>

						<div class="option-groups-management" id="optionGroupsManagement">
						</div>

						<button class="add-btn action-btn" id="addOptionGroupBtn">
							<i class="fas fa-plus"></i> 添加选项组
						</button>

						<h4 class="section-title" style="margin-top: 30px; font-size: 1.4rem;">
							<i class="fas fa-th-list"></i>
							固定搭配管理（可选）
						</h4>

						<div class="fixed-items-management" id="fixedItemsManagement">
						</div>

						<button class="add-btn action-btn" id="addFixedItemBtn">
							<i class="fas fa-plus"></i> 添加固定搭配项
						</button>

						<div style="margin-top: 30px; display: flex; gap: 15px;">
							<button class="add-btn action-btn" id="saveMealBtn" style="padding: 12px 30px;">
								<i class="fas fa-save"></i> 保存套餐
							</button>
							<button class="filter-btn" id="cancelEditBtn" style="padding: 12px 30px; display: none;">
								<i class="fas fa-times"></i> 取消编辑
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="image-modal" id="imageModal">
			<button class="close-modal" id="closeModal">
				<i class="fas fa-times"></i>
			</button>
			<img class="modal-image" id="modalImage" src="" alt="预览图片">
		</div>
		const APP_ID = 'Tu8MLJ2PHUY0z4Kgol3hockE-gzGzoHsz';
		const APP_KEY = '7sdmY7swmMFU9ppvBGheW4oz';
		const SERVER_URL = 'https://tu8mlj2p.lc-cn-n1-shared.com'; // 如果是国际版可以删除这行

		// 初始化 LeanCloud
		AV.init({
		appId: APP_ID,
		appKey: APP_KEY,
		serverURLs: SERVER_URL || 'https://tu8mlj2p.lc-cn-n1-shared.com' // 国际版
		});
		<script>
			// LeanCloud 数据存储函数
			// 套餐数据操作
			const Meal = AV.Object.extend('Meals');
			const Order = AV.Object.extend('Orders');
			const Counter = AV.Object.extend('Counters');
			const User = AV.Object.extend('Users');

			// 全局变量
			let meals = [];
			let cart = [];
			let orders = [];
			let newOrdersCount = 0;
			const ADMIN_PASSWORD = "200104";

			// 用户标识符
			let currentUserId = localStorage.getItem('kfcUserId');
			let currentUser = null;

			// 初始化数据
			async function initData() {
				try {
					// 获取或创建用户
					await getOrCreateUser();

					// 获取套餐数据
					await fetchMeals();

					// 获取订单数据
					await fetchOrders();

					// 获取新订单计数
					await fetchNewOrdersCount();

					console.log('数据初始化完成');
				} catch (error) {
					console.error('初始化数据失败:', error);
					showNotification('数据加载失败，请刷新页面重试', 'error');
				}
			}

			// 获取或创建用户
			async function getOrCreateUser() {
				if (!currentUserId) {
					currentUserId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
					localStorage.setItem('kfcUserId', currentUserId);
				}

				try {
					// 查询用户
					const query = new AV.Query('Users');
					query.equalTo('userId', currentUserId);
					const results = await query.find();

					if (results.length > 0) {
						currentUser = results[0];
					} else {
						// 创建新用户
						currentUser = new User();
						currentUser.set('userId', currentUserId);
						currentUser.set('createdAt', new Date());
						currentUser.set('lastLogin', new Date());
						await currentUser.save();
					}

					// 更新最后登录时间
					currentUser.set('lastLogin', new Date());
					await currentUser.save();

				} catch (error) {
					console.error('获取用户失败:', error);
					// 创建临时用户对象
					currentUser = {
						id: currentUserId
					};
				}

				// 显示用户ID
				const userIdDisplay = document.getElementById('currentUserIdDisplay');
				if (userIdDisplay) {
					userIdDisplay.textContent = currentUserId.substring(0, 12) + '...';
				}
			}

			// 从 LeanCloud 获取套餐数据
			async function fetchMeals() {
				try {
					const query = new AV.Query('Meals');
					query.addDescending('createdAt'); // 按创建时间降序
					const results = await query.find();

					meals = results.map(meal => {
						const data = meal.toJSON();
						return {
							id: meal.id,
							name: data.name,
							price: data.price,
							tags: data.tags || [],
							description: data.description,
							active: data.active !== false,
							optionGroups: data.optionGroups || [],
							fixedItems: data.fixedItems || [],
							createdAt: data.createdAt,
							updatedAt: data.updatedAt
						};
					});

					// 保存到本地存储作为缓存
					localStorage.setItem('kfcMeals', JSON.stringify(meals));

					return meals;
				} catch (error) {
					console.error('获取套餐数据失败:', error);
					// 尝试从本地存储恢复
					const localMeals = JSON.parse(localStorage.getItem('kfcMeals')) || [];
					if (localMeals.length > 0) {
						meals = localMeals;
						showNotification('使用本地缓存数据', 'info');
					}
					return meals;
				}
			}

			// 保存套餐到 LeanCloud
			async function saveMeal(mealData) {
				try {
					let mealObject;

					if (mealData.id && mealData.id.startsWith('meal-')) {
						// 更新现有套餐
						mealObject = AV.Object.createWithoutData('Meals', mealData.id);
					} else {
						// 创建新套餐
						mealObject = new Meal();
					}

					// 设置套餐属性
					mealObject.set('name', mealData.name);
					mealObject.set('price', mealData.price);
					mealObject.set('tags', mealData.tags);
					mealObject.set('description', mealData.description);
					mealObject.set('active', mealData.active !== false);
					mealObject.set('optionGroups', mealData.optionGroups || []);
					mealObject.set('fixedItems', mealData.fixedItems || []);

					// 保存到 LeanCloud
					await mealObject.save();

					// 更新本地数据
					const mealIndex = meals.findIndex(m => m.id === mealData.id);
					const updatedMeal = {
						...mealData,
						id: mealObject.id,
						createdAt: mealData.createdAt || new Date().toISOString(),
						updatedAt: new Date().toISOString()
					};

					if (mealIndex >= 0) {
						meals[mealIndex] = updatedMeal;
					} else {
						meals.push(updatedMeal);
					}

					// 更新本地存储
					localStorage.setItem('kfcMeals', JSON.stringify(meals));

					return updatedMeal;
				} catch (error) {
					console.error('保存套餐失败:', error);
					throw error;
				}
			}

			// 删除套餐
			async function deleteMealFromCloud(mealId) {
				try {
					const mealObject = AV.Object.createWithoutData('Meals', mealId);
					await mealObject.destroy();

					// 从本地数据中移除
					const mealIndex = meals.findIndex(m => m.id === mealId);
					if (mealIndex >= 0) {
						meals.splice(mealIndex, 1);
						localStorage.setItem('kfcMeals', JSON.stringify(meals));
					}

					return true;
				} catch (error) {
					console.error('删除套餐失败:', error);
					throw error;
				}
			}

			// 从 LeanCloud 获取订单数据
			async function fetchOrders() {
				try {
					const query = new AV.Query('Orders');
					query.addDescending('createdAt'); // 按创建时间降序

					// 如果是普通用户，只获取自己的订单
					if (currentUserId && !window.isAdmin) {
						query.equalTo('userId', currentUserId);
					}

					const results = await query.find();

					orders = results.map(order => {
						const data = order.toJSON();
						return {
							id: data.orderId || order.id,
							timestamp: data.timestamp || data.createdAt,
							status: data.status || 'new',
							cart: data.cart || [],
							deliveryInfo: data.deliveryInfo || '',
							orderNote: data.orderNote || '',
							deliveryType: data.deliveryType || 'delivery',
							totalPrice: data.totalPrice || 0,
							hasScreenshot: data.hasScreenshot || false,
							screenshotData: data.screenshotData || null,
							userId: data.userId || currentUserId,
							createdAt: data.createdAt
						};
					});

					// 保存到本地存储作为缓存
					localStorage.setItem('kfcOrders', JSON.stringify(orders));

					return orders;
				} catch (error) {
					console.error('获取订单数据失败:', error);
					// 尝试从本地存储恢复
					const localOrders = JSON.parse(localStorage.getItem('kfcOrders')) || [];
					if (localOrders.length > 0) {
						orders = localOrders.filter(order =>
							window.isAdmin || order.userId === currentUserId
						);
						showNotification('使用本地订单缓存', 'info');
					}
					return orders;
				}
			}

			// 保存订单到 LeanCloud
			async function saveOrder(orderData) {
				try {
					const orderObject = new Order();

					// 设置订单属性
					orderObject.set('orderId', orderData.id);
					orderObject.set('timestamp', orderData.timestamp);
					orderObject.set('status', orderData.status);
					orderObject.set('cart', orderData.cart);
					orderObject.set('deliveryInfo', orderData.deliveryInfo);
					orderObject.set('orderNote', orderData.orderNote);
					orderObject.set('deliveryType', orderData.deliveryType);
					orderObject.set('totalPrice', orderData.totalPrice);
					orderObject.set('hasScreenshot', orderData.hasScreenshot);
					orderObject.set('screenshotData', orderData.screenshotData);
					orderObject.set('userId', orderData.userId);

					// 保存到 LeanCloud
					await orderObject.save();

					// 添加到本地数据
					orders.unshift(orderData);
					localStorage.setItem('kfcOrders', JSON.stringify(orders));

					// 更新新订单计数
					await incrementNewOrdersCount();

					return orderData;
				} catch (error) {
					console.error('保存订单失败:', error);

					// 如果云端保存失败，保存到本地
					orders.unshift(orderData);
					localStorage.setItem('kfcOrders', JSON.stringify(orders));

					showNotification('订单已保存到本地，稍后将同步到云端', 'info');
					return orderData;
				}
			}

			// 更新订单状态
			async function updateOrderStatus(orderId, status) {
				try {
					const query = new AV.Query('Orders');
					query.equalTo('orderId', orderId);
					const results = await query.find();

					if (results.length > 0) {
						const orderObject = results[0];
						orderObject.set('status', status);
						await orderObject.save();
					}

					// 更新本地数据
					const orderIndex = orders.findIndex(o => o.id === orderId);
					if (orderIndex >= 0) {
						orders[orderIndex].status = status;
						localStorage.setItem('kfcOrders', JSON.stringify(orders));
					}

					return true;
				} catch (error) {
					console.error('更新订单状态失败:', error);
					throw error;
				}
			}

			// 删除订单
			async function deleteOrderFromCloud(orderId) {
				try {
					const query = new AV.Query('Orders');
					query.equalTo('orderId', orderId);
					const results = await query.find();

					if (results.length > 0) {
						await results[0].destroy();
					}

					// 从本地数据中移除
					const orderIndex = orders.findIndex(o => o.id === orderId);
					if (orderIndex >= 0) {
						orders.splice(orderIndex, 1);
						localStorage.setItem('kfcOrders', JSON.stringify(orders));
					}

					return true;
				} catch (error) {
					console.error('删除订单失败:', error);
					throw error;
				}
			}

			// 获取新订单计数
			async function fetchNewOrdersCount() {
				try {
					const query = new AV.Query('Counters');
					query.equalTo('name', 'newOrders');
					const results = await query.find();

					if (results.length > 0) {
						newOrdersCount = results[0].get('count') || 0;
					} else {
						// 创建计数器
						const counter = new Counter();
						counter.set('name', 'newOrders');
						counter.set('count', 0);
						await counter.save();
						newOrdersCount = 0;
					}

					localStorage.setItem('newOrdersCount', newOrdersCount);

					return newOrdersCount;
				} catch (error) {
					console.error('获取新订单计数失败:', error);
					newOrdersCount = parseInt(localStorage.getItem('newOrdersCount')) || 0;
					return newOrdersCount;
				}
			}

			// 增加新订单计数
			async function incrementNewOrdersCount() {
				try {
					const query = new AV.Query('Counters');
					query.equalTo('name', 'newOrders');
					const results = await query.find();

					if (results.length > 0) {
						const counter = results[0];
						const currentCount = counter.get('count') || 0;
						counter.set('count', currentCount + 1);
						await counter.save();
						newOrdersCount = currentCount + 1;
					} else {
						const counter = new Counter();
						counter.set('name', 'newOrders');
						counter.set('count', 1);
						await counter.save();
						newOrdersCount = 1;
					}

					localStorage.setItem('newOrdersCount', newOrdersCount);
					updateOrderBadge();

					return newOrdersCount;
				} catch (error) {
					console.error('更新新订单计数失败:', error);
					newOrdersCount = (parseInt(localStorage.getItem('newOrdersCount')) || 0) + 1;
					localStorage.setItem('newOrdersCount', newOrdersCount);
					updateOrderBadge();
					return newOrdersCount;
				}
			}

			// 重置新订单计数
			async function resetNewOrdersCount() {
				try {
					const query = new AV.Query('Counters');
					query.equalTo('name', 'newOrders');
					const results = await query.find();

					if (results.length > 0) {
						const counter = results[0];
						counter.set('count', 0);
						await counter.save();
					}

					newOrdersCount = 0;
					localStorage.setItem('newOrdersCount', newOrdersCount);
					updateOrderBadge();

					return true;
				} catch (error) {
					console.error('重置新订单计数失败:', error);
					newOrdersCount = 0;
					localStorage.setItem('newOrdersCount', newOrdersCount);
					updateOrderBadge();
					return true;
				}
			}

			// 清空所有订单
			async function clearAllOrdersFromCloud() {
				try {
					const query = new AV.Query('Orders');
					const results = await query.find();

					// 批量删除
					await AV.Object.destroyAll(results);

					// 清空本地数据
					orders = [];
					localStorage.setItem('kfcOrders', JSON.stringify(orders));

					// 重置计数器
					await resetNewOrdersCount();

					return true;
				} catch (error) {
					console.error('清空订单失败:', error);
					throw error;
				}
			}

			// 修改 DOMContentLoaded 事件处理
			document.addEventListener('DOMContentLoaded', async function() {
				// 先初始化 LeanCloud 数据
				await initData();

				// 然后初始化页面
				initHomePage();
				initAdminPanel();
				initMealManagement();
				updateCartDisplay();
				updateOrderBadge();
				initImagePreview();
				initPasswordVerification();
				initStatusToggle();
				initMyOrdersPage();
				initHeaderButtons();

				checkUrlParams();
			});

			// 修改 showNotification 函数，添加同步状态显示
			function showNotification(message, type = 'info') {
				// 原有的通知代码保持不变，只添加以下判断
				if (message.includes('保存到本地') || message.includes('同步')) {
					// 对于同步相关的消息，显示更长时间
					notificationDuration = 5000;
				}
				// ... 原有代码 ...
			}

			// 添加自动同步功能
			async function syncData() {
				try {
					// 同步套餐数据
					await fetchMeals();
					updateHomePage();

					// 同步订单数据
					await fetchOrders();

					// 如果是管理员，更新订单列表
					if (window.isAdmin) {
						renderOrders('all');
					}

					// 更新用户订单
					renderUserOrders('all');

					console.log('数据同步完成');
				} catch (error) {
					console.error('数据同步失败:', error);
				}
			}

			// 定期同步数据（每30秒一次）
			setInterval(syncData, 30000);

			// 添加手动同步按钮
			function addSyncButton() {
				const syncBtn = document.createElement('button');
				syncBtn.className = 'header-btn';
				syncBtn.id = 'syncBtn';
				syncBtn.innerHTML = '<i class="fas fa-sync-alt"></i> 同步数据';
				syncBtn.addEventListener('click', syncData);

				const headerButtons = document.querySelector('.header-buttons');
				if (headerButtons) {
					headerButtons.appendChild(syncBtn);
				}
			}

			// 在 initHeaderButtons 中添加同步按钮
			function initHeaderButtons() {
				// 原有代码...
				addSyncButton();
			}

			// 修改保存套餐函数，调用云端保存
			async function saveMeal() {
				// 原有验证代码...

				// 修改保存部分
				try {
					const mealData = {
						id: document.getElementById('currentMealId').value,
						name: mealName,
						price: mealPrice,
						tags: mealTags,
						description: mealDescription,
						active: mealActive,
						optionGroups: optionGroups,
						fixedItems: fixedItems
					};

					await saveMeal(mealData);

					// 更新页面
					updateHomePage();
					updateMealList('all');

					resetMealForm();
					document.querySelector('.admin-tab[data-tab="meals"]').click();

					showNotification(mealData.id ? '套餐已更新并同步到云端' : '套餐已添加并同步到云端', 'success');
				} catch (error) {
					showNotification('保存失败，请检查网络连接', 'error');
				}
			}

			// 修改删除套餐函数
			async function deleteMeal(mealId) {
				// 原有确认代码...

				try {
					await deleteMealFromCloud(mealId);

					updateHomePage();
					updateMealList('all');

					showNotification(`套餐已删除`, 'success');
				} catch (error) {
					showNotification('删除失败，请检查网络连接', 'error');
				}
			}

			// 修改 completeCheckout 函数
			async function completeCheckout(deliveryType, orderNote, deliveryInfo, hasScreenshot, screenshotData, container) {
				// 原有确认代码...

				if (confirmed) {
					const orderId = 'KFC' + Date.now().toString().slice(-6) + Math.floor(Math.random() * 100);
					const timestamp = new Date().toLocaleString('zh-CN');

					const orderData = {
						id: orderId,
						timestamp: timestamp,
						status: 'new',
						cart: JSON.parse(JSON.stringify(cart)),
						deliveryInfo: deliveryInfo,
						orderNote: orderNote,
						deliveryType: deliveryType,
						totalPrice: totalPrice,
						hasScreenshot: hasScreenshot,
						screenshotData: screenshotData,
						userId: currentUserId
					};

					try {
						// 保存到云端
						await saveOrder(orderData);

						cart = [];
						updateCartDisplay();
						resetForm(container);

						// 后续处理...
					} catch (error) {
						// 即使云端保存失败，本地已保存
						// 后续处理...
					}
				}
			}

			// 修改 handleOrderAction 函数
			async function handleOrderAction(action, orderId) {
				// 原有确认代码...

				if (confirm(confirmMessage)) {
					try {
						switch (action) {
							case 'process':
								await updateOrderStatus(orderId, 'processing');
								break;
							case 'complete':
								await updateOrderStatus(orderId, 'completed');
								break;
							case 'delete':
								await deleteOrderFromCloud(orderId);
								break;
						}

						// 更新显示
						const activeFilterBtn = document.querySelector('.filter-btn.active');
						const activeFilter = activeFilterBtn ? activeFilterBtn.dataset.filter : 'all';
						renderOrders(activeFilter);

						showNotification(`订单 ${orderId} 操作成功`, 'success');
					} catch (error) {
						showNotification('操作失败，请检查网络连接', 'error');
					}
				}
			}

			// 修改 clearAllOrders 事件监听
			clearAllOrders.addEventListener('click', async function() {
				if (orders.length > 0 && confirm('确定要清空所有订单吗？此操作不可恢复！')) {
					try {
						await clearAllOrdersFromCloud();
						renderOrders('all');
						showNotification('已清空所有订单', 'success');
					} catch (error) {
						showNotification('清空失败，请检查网络连接', 'error');
					}
				}
			});
			adminTabs.forEach(tab => {
				tab.addEventListener('click', function() {
					const tabId = this.dataset.tab;

					adminTabs.forEach(t => t.classList.remove('active'));

					this.classList.add('active');

					document.querySelectorAll('.admin-tab-content').forEach(content => {
						content.classList.remove('active');
					});

					document.getElementById(`${tabId}Tab`).classList.add('active');

					if (tabId === 'meals') {
						updateMealList('all');
					}
				});
			});

			document.querySelectorAll('.filter-btn').forEach(btn => {
				if (btn.id !== 'clearAllOrders') {
					btn.addEventListener('click', function() {
						document.querySelectorAll('.filter-btn').forEach(b => {
							if (b.id !== 'clearAllOrders') {
								b.classList.remove('active');
							}
						});

						this.classList.add('active');

						const filter = this.dataset.filter;
						renderOrders(filter);
					});
				}
			});
			}

			function renderOrders(filter = 'all') {
				const ordersContainer = document.getElementById('ordersContainer');
				const noOrdersMessage = document.getElementById('noOrdersMessage');

				const orderElements = ordersContainer.querySelectorAll('.admin-order-item');
				orderElements.forEach(el => el.remove());

				let filteredOrders = orders;
				if (filter !== 'all') {
					filteredOrders = orders.filter(order => order.status === filter);
				}

				if (filteredOrders.length === 0) {
					noOrdersMessage.style.display = 'block';
					return;
				}

				noOrdersMessage.style.display = 'none';

				filteredOrders.forEach(order => {
					const orderElement = createOrderElement(order);
					ordersContainer.appendChild(orderElement);
				});
			}

			function createOrderElement(order) {
				const orderElement = document.createElement('div');
				orderElement.className = 'admin-order-item';

				let statusText, statusClass;
				switch (order.status) {
					case 'new':
						statusText = '新订单';
						statusClass = 'status-new';
						break;
					case 'processing':
						statusText = '处理中';
						statusClass = 'status-processing';
						break;
					case 'completed':
						statusText = '已完成';
						statusClass = 'status-completed';
						break;
					default:
						statusText = '新订单';
						statusClass = 'status-new';
				}

				const deliveryTypeText = order.deliveryType === 'delivery' ? '宅急送' : '到店自提';

				let itemsHTML = '';
				order.cart.forEach(item => {
					const optionCount = {};
					item.options.forEach(option => {
						optionCount[option] = (optionCount[option] || 0) + 1;
					});

					const optionText = Object.keys(optionCount).map(option => {
						const count = optionCount[option];
						return `${option}${count > 1 ? ` ×${count}` : ''}`;
					}).join(', ');

					itemsHTML +=
						`<div class="order-item-detail">
		                <div><strong>${item.name}</strong> - ¥${item.totalPrice.toFixed(2)}</div>
		                <div style="font-size:0.9rem; color:#666;">${optionText}</div>
		            </div>`;
				});

				const infoLines = order.deliveryInfo.split('\n');
				let deliveryHTML = '';
				infoLines.forEach(line => {
					if (line.trim()) {
						deliveryHTML += `<p>${line}</p>`;
					}
				});

				let screenshotHTML = '';
				if (order.hasScreenshot && order.screenshotData) {
					screenshotHTML =
						`
		                <div class="screenshot-container">
		                    <p><strong>门店截图：</strong></p>
		                    <img src="${order.screenshotData}" alt="门店截图" class="screenshot-thumbnail" data-order-id="${order.id}">
		                </div>
		            `;
				}

				const userInfo = order.userId ? `<p><strong>用户ID：</strong>${order.userId.substring(0, 12)}...</p>` : '';

				orderElement.innerHTML =
					`
		            <div class="order-id">订单号：${order.id}</div>
		            <div class="order-time">${order.timestamp} | ${deliveryTypeText}</div>
		            <div class="order-status ${statusClass}">${statusText}</div>
		            
		            <div class="order-details">
		                <div class="order-items">
		                    ${itemsHTML}
		                </div>
		                
		                <div class="order-total">
		                    总计：¥${order.totalPrice.toFixed(2)}
		                </div>
		            </div>
		            
		            <div class="customer-info">
		                ${deliveryHTML}
		                ${userInfo}
		                ${order.orderNote ? `<p><strong>备注：</strong>${order.orderNote}</p>` : ''}
		                ${screenshotHTML}
		            </div>
		            
		            <div style="margin-top: 15px; display: flex; gap: 10px;">
		                ${order.status === 'new' ? `<button class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem;" data-action="process" data-order-id="${order.id}">标记为处理中</button>` : ''}
		                ${order.status === 'processing' ? `<button class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem;" data-action="complete" data-order-id="${order.id}">标记为已完成</button>` : ''}
		                <button class="filter-btn" style="padding: 6px 12px; font-size: 0.9rem; background-color: #f44336; color: white;" data-action="delete" data-order-id="${order.id}">删除订单</button>
		            </div>
		        `;

				orderElement.querySelectorAll('button[data-action]').forEach(btn => {
					btn.addEventListener('click', function() {
						const action = this.dataset.action;
						const orderId = this.dataset.orderId;
						handleOrderAction(action, orderId);
					});
				});

				if (order.hasScreenshot && order.screenshotData) {
					const screenshotImg = orderElement.querySelector('.screenshot-thumbnail');
					if (screenshotImg) {
						screenshotImg.addEventListener('click', function() {
							showFullImage(order.screenshotData);
						});
					}
				}

				return orderElement;
			}

			function handleOrderAction(action, orderId) {
				const orderIndex = orders.findIndex(o => o.id === orderId);
				if (orderIndex === -1) return;

				let confirmMessage = '';

				switch (action) {
					case 'process':
						confirmMessage = `确认将订单 ${orderId} 标记为处理中吗？`;
						break;
					case 'complete':
						confirmMessage = `确认将订单 ${orderId} 标记为已完成吗？`;
						break;
					case 'delete':
						confirmMessage = `确认删除订单 ${orderId} 吗？`;
						break;
				}

				if (confirm(confirmMessage)) {
					switch (action) {
						case 'process':
							orders[orderIndex].status = 'processing';
							break;
						case 'complete':
							orders[orderIndex].status = 'completed';
							break;
						case 'delete':
							orders.splice(orderIndex, 1);
							break;
					}

					localStorage.setItem('kfcOrders', JSON.stringify(orders));

					const activeFilterBtn = document.querySelector('.filter-btn.active');
					const activeFilter = activeFilterBtn ? activeFilterBtn.dataset.filter : 'all';

					renderOrders(activeFilter);

					showNotification(`订单 ${orderId} 操作成功`, 'success');
				}
			}

			// 初始化套餐管理功能
			function initMealManagement() {
				updateMealList('all');

				// 添加套餐过滤器的事件监听
				document.querySelectorAll('.meal-filter-btn').forEach(btn => {
					btn.addEventListener('click', function() {
						document.querySelectorAll('.meal-filter-btn').forEach(b => {
							b.classList.remove('active');
						});

						this.classList.add('active');

						const filter = this.dataset.mealFilter;
						updateMealList(filter);
					});
				});

				// 添加选项组按钮
				document.getElementById('addOptionGroupBtn').addEventListener('click', function() {
					addOptionGroup();
				});

				// 添加固定搭配项按钮
				document.getElementById('addFixedItemBtn').addEventListener('click', function() {
					addFixedItem();
				});

				// 保存套餐按钮
				document.getElementById('saveMealBtn').addEventListener('click', function() {
					saveMeal();
				});

				// 取消编辑按钮
				document.getElementById('cancelEditBtn').addEventListener('click', function() {
					cancelEdit();
				});

				// 标签页切换事件
				document.querySelectorAll('.admin-tab').forEach(tab => {
					tab.addEventListener('click', function() {
						const tabId = this.dataset.tab;
						if (tabId === 'addMeal') {
							resetMealForm();
						}
					});
				});

				// 添加键盘快捷键：Ctrl+S 保存套餐
				document.addEventListener('keydown', function(e) {
					if ((e.ctrlKey || e.metaKey) && e.key === 's' &&
						document.getElementById('addMealTab').classList.contains('active')) {
						e.preventDefault();
						saveMeal();
					}

					// Esc 键取消编辑
					if (e.key === 'Escape' && document.getElementById('cancelEditBtn').style.display !== 'none') {
						cancelEdit();
					}
				});

				// 监听状态切换按钮的变化，实时更新用户端
				const statusToggle = document.getElementById('mealActive');
				if (statusToggle) {
					statusToggle.addEventListener('change', function() {
						// 实时更新状态文本
						const statusText = document.getElementById('statusText');
						if (this.checked) {
							statusText.textContent = '上架';
							statusText.className = 'status-active';
						} else {
							statusText.textContent = '下架';
							statusText.className = 'status-inactive';
						}
					});
				}

				// 初始化时添加一个默认选项组
				if (document.querySelectorAll('.option-group-item').length === 0) {
					addOptionGroup();
				}
			}

			// 更新套餐列表
			function updateMealList(filter = 'all') {
				const mealList = document.getElementById('mealList');
				const noMealsAdminMessage = document.getElementById('noMealsAdminMessage');

				mealList.innerHTML = '';

				let filteredMeals = meals;
				if (filter === 'active') {
					filteredMeals = meals.filter(meal => meal.active !== false);
				} else if (filter === 'inactive') {
					filteredMeals = meals.filter(meal => meal.active === false);
				}

				// 按创建时间排序，最新的在前面
				filteredMeals.sort((a, b) => {
					const aTime = a.createdAt || 0;
					const bTime = b.createdAt || 0;
					return bTime - aTime;
				});

				if (filteredMeals.length === 0) {
					noMealsAdminMessage.style.display = 'block';
					return;
				}

				noMealsAdminMessage.style.display = 'none';

				filteredMeals.forEach(meal => {
					const mealItem = document.createElement('div');
					mealItem.className = 'meal-list-item';

					// 计算选项总数
					let totalOptions = 0;
					if (meal.optionGroups && meal.optionGroups.length > 0) {
						meal.optionGroups.forEach(group => {
							if (group.items) {
								totalOptions += group.items.length;
							}
						});
					}

					// 计算固定搭配总数
					let totalFixed = 0;
					if (meal.fixedItems && meal.fixedItems.length > 0) {
						meal.fixedItems.forEach(item => {
							totalFixed += item.quantity || 1;
						});
					}

					// 添加创建时间显示
					const createdAt = meal.createdAt ? new Date(meal.createdAt).toLocaleString('zh-CN') : '未知时间';

					mealItem.innerHTML =
						`
		                <div class="meal-list-item-info">
		                    <h4>${meal.name} ${meal.active === false ? '<span class="status-inactive">(已下架)</span>' : '<span class="status-active">(已上架)</span>'}</h4>
		                    <p><strong>价格:</strong> ¥${meal.price} | <strong>标签:</strong> ${meal.tags.join(', ')}</p>
		                    <p><strong>描述:</strong> ${meal.description}</p>
		                    <p><strong>创建时间:</strong> ${createdAt}</p>
		                    <p><strong>选项组:</strong> ${meal.optionGroups ? meal.optionGroups.length : 0} 个 | 
		                       <strong>选项项:</strong> ${totalOptions} 个 | 
		                       <strong>固定搭配:</strong> ${totalFixed} 项</p>
		                </div>
		                <div class="meal-list-item-actions">
		                    <div class="status-label">
		                        <label class="status-toggle">
		                            <input type="checkbox" class="status-toggle-input" data-meal-id="${meal.id}" ${meal.active !== false ? 'checked' : ''}>
		                            <span class="status-slider"></span>
		                        </label>
		                        <span class="${meal.active !== false ? 'status-active' : 'status-inactive'}">${meal.active !== false ? '上架' : '下架'}</span>
		                    </div>
		                    <div style="display: flex; gap: 10px;">
		                        <button class="action-btn edit-btn" data-meal-id="${meal.id}">
		                            <i class="fas fa-edit"></i> 编辑
		                        </button>
		                        <button class="action-btn delete-btn" data-meal-id="${meal.id}">
		                            <i class="fas fa-trash"></i> 删除
		                        </button>
		                    </div>
		                </div>
		            `;

					mealList.appendChild(mealItem);
				});

				// 绑定状态切换事件
				document.querySelectorAll('.status-toggle-input').forEach(toggle => {
					toggle.addEventListener('change', function() {
						const mealId = this.dataset.mealId;
						const isActive = this.checked;
						toggleMealStatus(mealId, isActive);
					});
				});

				// 绑定编辑按钮事件
				document.querySelectorAll('.edit-btn').forEach(btn => {
					btn.addEventListener('click', function() {
						const mealId = this.dataset.mealId;
						editMeal(mealId);
					});
				});

				// 绑定删除按钮事件
				document.querySelectorAll('.delete-btn').forEach(btn => {
					btn.addEventListener('click', function() {
						const mealId = this.dataset.mealId;
						deleteMeal(mealId);
					});
				});
			}

			// 切换套餐状态
			function toggleMealStatus(mealId, isActive) {
				const mealIndex = meals.findIndex(m => m.id === mealId);
				if (mealIndex === -1) return;

				const meal = meals[mealIndex];
				const action = isActive ? '上架' : '下架';

				if (confirm(`确定要将套餐 "${meal.name}" ${action} 吗？${isActive ? '' : '下架后用户将无法看到此套餐。'}`)) {
					meals[mealIndex].active = isActive;
					meals[mealIndex].updatedAt = Date.now(); // 记录更新时间
					localStorage.setItem('kfcMeals', JSON.stringify(meals));

					updateHomePage();

					const activeFilter = document.querySelector('.meal-filter-btn.active').dataset.mealFilter;
					updateMealList(activeFilter);

					showNotification(`套餐"${meal.name}"已${action}`, 'success');
				} else {
					// 如果取消，恢复复选框状态
					const toggle = document.querySelector(`.status-toggle-input[data-meal-id="${mealId}"]`);
					if (toggle) {
						toggle.checked = !isActive;
					}
				}
			}

			// 编辑套餐
			function editMeal(mealId) {
				const meal = meals.find(m => m.id === mealId);
				if (!meal) {
					showNotification('套餐不存在或已被删除', 'error');
					return;
				}

				// 填充表单
				document.getElementById('currentMealId').value = meal.id;
				document.getElementById('mealName').value = meal.name;
				document.getElementById('mealPrice').value = meal.price;
				document.getElementById('mealTags').value = meal.tags.join(', ');
				document.getElementById('mealDescription').value = meal.description;
				document.getElementById('mealActive').checked = meal.active !== false;

				// 更新状态文本
				const statusText = document.getElementById('statusText');
				if (meal.active !== false) {
					statusText.textContent = '上架';
					statusText.className = 'status-active';
				} else {
					statusText.textContent = '下架';
					statusText.className = 'status-inactive';
				}

				// 更新标题
				document.getElementById('addMealTitle').innerHTML =
					`<i class="fas fa-edit"></i> 编辑套餐：${meal.name.substring(0, 20)}${meal.name.length > 20 ? '...' : ''}`;

				// 显示取消编辑按钮
				document.getElementById('cancelEditBtn').style.display = 'block';

				// 清空选项组和固定搭配
				document.getElementById('optionGroupsManagement').innerHTML = '';
				document.getElementById('fixedItemsManagement').innerHTML = '';

				// 添加选项组
				if (meal.optionGroups && meal.optionGroups.length > 0) {
					meal.optionGroups.forEach((group, index) => {
						const groupId = 'group-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

						const optionGroup = document.createElement('div');
						optionGroup.className = 'option-group-item';
						optionGroup.innerHTML =
							`
		                    <div class="option-group-header">
		                        <div class="option-group-title">选项组 ${index + 1}</div>
		                        <div>
		                            <button class="action-btn add-btn add-option-item-btn" data-group-id="${groupId}">
		                                <i class="fas fa-plus"></i> 添加选项
		                            </button>
		                            <button class="action-btn delete-btn delete-option-group-btn" data-group-id="${groupId}">
		                                <i class="fas fa-trash"></i> 删除组
		                            </button>
		                        </div>
		                    </div>
		                    <div class="form-row">
		                        <div class="form-group">
		                            <label class="form-label">组标题 <span class="required">*</span></label>
		                            <input type="text" class="form-input option-group-title-input" data-group-id="${groupId}" placeholder="例如：① 任选3份（可以重复选）" value="${group.title || '选项组' + (index + 1)}">
		                        </div>
		                        <div class="form-group">
		                            <label class="form-label">规则描述 <span class="required">*</span></label>
		                            <input type="text" class="form-input option-group-rules-input" data-group-id="${groupId}" placeholder="例如：需要选择3份，可以重复选择相同选项" value="${group.rules || '请选择选项'}">
		                        </div>
		                    </div>
		                    <div class="form-row">
		                        <div class="form-group">
		                            <label class="form-label">最少选择数量 <span class="required">*</span></label>
		                            <input type="number" class="form-input option-group-min-input" data-group-id="${groupId}" placeholder="例如：3" min="0" value="${group.minSelect || 1}">
		                        </div>
		                        <div class="form-group">
		                            <label class="form-label">最多选择数量 <span class="required">*</span></label>
		                            <input type="number" class="form-input option-group-max-input" data-group-id="${groupId}" placeholder="例如：3" min="1" value="${group.maxSelect || 1}">
		                        </div>
		                    </div>
		                    <div class="form-row">
		                        <div class="form-group">
		                            <label class="form-label">是否可以重复选择</label>
		                            <div style="margin-top: 8px;">
		                                <label style="display: flex; align-items: center; gap: 8px;">
		                                    <input type="checkbox" class="option-group-repeat-input" data-group-id="${groupId}" ${group.repeat ? 'checked' : ''}>
		                                    <span>可以重复选择相同选项</span>
		                                </label>
		                            </div>
		                        </div>
		                        <div class="form-group">
		                            <label class="form-label">每个选项最多选择几份</label>
		                            <input type="number" class="form-input option-group-max-per-item-input" data-group-id="${groupId}" placeholder="例如：2" min="1" value="${group.maxPerItem || (group.repeat ? 999 : 1)}">
		                        </div>
		                    </div>
		                    <div class="option-items-list" id="option-items-${groupId}">
		                    </div>
		                `;

						document.getElementById('optionGroupsManagement').appendChild(optionGroup);

						// 绑定选项组按钮事件
						optionGroup.querySelector('.add-option-item-btn').addEventListener('click', function() {
							addOptionItem(groupId);
						});

						optionGroup.querySelector('.delete-option-group-btn').addEventListener('click', function() {
							deleteOptionGroup(groupId);
						});

						// 添加选项项
						if (group.items && group.items.length > 0) {
							group.items.forEach((item, itemIndex) => {
								addOptionItemToGroup(groupId, item.name, item.addPrice || 0);
							});
						} else {
							// 如果没有选项项，添加一个默认的
							addOptionItemToGroup(groupId, '选项1', 0);
						}
					});
				} else {
					// 如果没有选项组，添加一个默认的
					addOptionGroup();
				}

				// 添加固定搭配
				if (meal.fixedItems && meal.fixedItems.length > 0) {
					meal.fixedItems.forEach((item, index) => {
						addFixedItemWithData(item.name, item.quantity || 1);
					});
				}

				// 切换到添加套餐标签页
				document.querySelector('.admin-tab[data-tab="addMeal"]').click();

				// 滚动到顶部
				document.getElementById('addMealTab').scrollIntoView({
					behavior: 'smooth'
				});
			}

			// 添加选项组
			function addOptionGroup() {
				const optionGroupsManagement = document.getElementById('optionGroupsManagement');
				const groupId = 'group-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

				const optionGroup = document.createElement('div');
				optionGroup.className = 'option-group-item';
				optionGroup.innerHTML =
					`
		            <div class="option-group-header">
		                <div class="option-group-title">选项组 ${optionGroupsManagement.children.length + 1}</div>
		                <div>
		                    <button class="action-btn add-btn add-option-item-btn" data-group-id="${groupId}">
		                        <i class="fas fa-plus"></i> 添加选项
		                    </button>
		                    <button class="action-btn delete-btn delete-option-group-btn" data-group-id="${groupId}">
		                        <i class="fas fa-trash"></i> 删除组
		                    </button>
		                </div>
		            </div>
		            <div class="form-row">
		                <div class="form-group">
		                    <label class="form-label">组标题 <span class="required">*</span></label>
		                    <input type="text" class="form-input option-group-title-input" data-group-id="${groupId}" placeholder="例如：① 任选3份（可以重复选）" value="选项组 ${optionGroupsManagement.children.length + 1}">
		                </div>
		                <div class="form-group">
		                    <label class="form-label">规则描述 <span class="required">*</span></label>
		                    <input type="text" class="form-input option-group-rules-input" data-group-id="${groupId}" placeholder="例如：需要选择3份，可以重复选择相同选项" value="请选择选项">
		                </div>
		            </div>
		            <div class="form-row">
		                <div class="form-group">
		                    <label class="form-label">最少选择数量 <span class="required">*</span></label>
		                    <input type="number" class="form-input option-group-min-input" data-group-id="${groupId}" placeholder="例如：3" min="0" value="1">
		                </div>
		                <div class="form-group">
		                    <label class="form-label">最多选择数量 <span class="required">*</span></label>
		                    <input type="number" class="form-input option-group-max-input" data-group-id="${groupId}" placeholder="例如：3" min="1" value="1">
		                </div>
		            </div>
		            <div class="form-row">
		                <div class="form-group">
		                    <label class="form-label">是否可以重复选择</label>
		                    <div style="margin-top: 8px;">
		                        <label style="display: flex; align-items: center; gap: 8px;">
		                            <input type="checkbox" class="option-group-repeat-input" data-group-id="${groupId}" checked>
		                            <span>可以重复选择相同选项</span>
		                        </label>
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="form-label">每个选项最多选择几份</label>
		                    <input type="number" class="form-input option-group-max-per-item-input" data-group-id="${groupId}" placeholder="例如：2" min="1" value="999">
		                </div>
		            </div>
		            <div class="option-items-list" id="option-items-${groupId}">
		            </div>
		        `;

				optionGroupsManagement.appendChild(optionGroup);

				// 绑定选项组按钮事件
				optionGroup.querySelector('.add-option-item-btn').addEventListener('click', function() {
					addOptionItem(groupId);
				});

				optionGroup.querySelector('.delete-option-group-btn').addEventListener('click', function() {
					deleteOptionGroup(groupId);
				});

				// 添加一个默认选项项
				addOptionItemToGroup(groupId, '选项1', 0);
			}

			// 添加选项项
			function addOptionItem(groupId) {
				addOptionItemToGroup(groupId, '新选项', 0);
			}

			// 辅助函数：添加选项项到指定组
			function addOptionItemToGroup(groupId, name, price) {
				const optionItemsList = document.getElementById(`option-items-${groupId}`);
				if (!optionItemsList) return;

				const itemId = Date.now() + Math.random();

				const optionItem = document.createElement('div');
				optionItem.className = 'option-item-list-item';
				optionItem.innerHTML =
					`
		            <div style="display: flex; gap: 10px; width: 100%;">
		                <input type="text" class="form-input option-item-name-input" style="flex: 3;" placeholder="选项名称，例如：香辣鸡腿堡" value="${name || '选项'}">
		                <input type="number" class="form-input option-item-price-input" style="flex: 1;" placeholder="附加价格" min="0" step="0.01" value="${price || 0}">
		            </div>
		            <button class="action-btn delete-btn delete-option-item-btn" data-item-id="${itemId}">
		                <i class="fas fa-trash"></i>
		            </button>
		        `;

				optionItemsList.appendChild(optionItem);

				optionItem.querySelector('.delete-option-item-btn').addEventListener('click', function() {
					deleteOptionItem(itemId);
				});
			}

			// 删除选项组
			function deleteOptionGroup(groupId) {
				const groupElement = document.querySelector(`.option-group-item [data-group-id="${groupId}"]`).closest(
					'.option-group-item');
				if (groupElement) {
					groupElement.remove();
				}
			}

			// 删除选项项
			function deleteOptionItem(itemId) {
				const itemElement = document.querySelector(`[data-item-id="${itemId}"]`).closest('.option-item-list-item');
				if (itemElement) {
					itemElement.remove();
				}
			}

			// 添加固定搭配项
			function addFixedItem() {
				addFixedItemWithData('固定搭配项', 1);
			}

			// 辅助函数：添加带数据的固定搭配项
			function addFixedItemWithData(name, quantity) {
				const fixedItemsManagement = document.getElementById('fixedItemsManagement');
				if (!fixedItemsManagement) return;

				const fixedItem = document.createElement('div');
				fixedItem.className = 'fixed-item-list-item';
				fixedItem.innerHTML =
					`
		            <div style="display: flex; gap: 10px; width: 100%;">
		                <input type="text" class="form-input fixed-item-name-input" style="flex: 3;" placeholder="固定搭配项名称，例如：可乐" value="${name || '固定搭配项'}">
		                <input type="number" class="form-input fixed-item-quantity-input" style="flex: 1;" placeholder="数量" min="1" value="${quantity || 1}">
		            </div>
		            <button class="action-btn delete-btn delete-fixed-item-btn">
		                <i class="fas fa-trash"></i>
		            </button>
		        `;

				fixedItemsManagement.appendChild(fixedItem);

				fixedItem.querySelector('.delete-fixed-item-btn').addEventListener('click', function() {
					fixedItem.remove();
				});
			}

			// 删除套餐
			function deleteMeal(mealId) {
				const mealIndex = meals.findIndex(m => m.id === mealId);
				if (mealIndex === -1) return;

				const meal = meals[mealIndex];

				if (!confirm(`确定要删除套餐 "${meal.name}" 吗？\n\n价格：¥${meal.price}\n标签：${meal.tags.join(', ')}\n\n此操作不可恢复！`)) {
					return;
				}

				// 检查是否有订单包含此套餐
				let hasOrders = false;
				orders.forEach(order => {
					order.cart.forEach(item => {
						if (item.id === mealId) {
							hasOrders = true;
						}
					});
				});

				if (hasOrders) {
					if (!confirm('警告：有订单包含此套餐。删除套餐不会删除相关订单，但会影响订单详情显示。\n\n确定要继续删除吗？')) {
						return;
					}
				}

				meals.splice(mealIndex, 1);
				localStorage.setItem('kfcMeals', JSON.stringify(meals));

				updateHomePage();

				const activeFilter = document.querySelector('.meal-filter-btn.active').dataset.mealFilter;
				updateMealList(activeFilter);

				showNotification(`套餐"${meal.name}"已删除`, 'success');
			}

			// 保存套餐
			function saveMeal() {
				const mealId = document.getElementById('currentMealId').value;
				const mealName = document.getElementById('mealName').value.trim();
				const mealPrice = parseFloat(document.getElementById('mealPrice').value);
				const mealTags = document.getElementById('mealTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
				const mealDescription = document.getElementById('mealDescription').value.trim();
				const mealActive = document.getElementById('mealActive').checked;

				// 验证必填字段
				if (!mealName) {
					showNotification('请填写套餐名称', 'error');
					document.getElementById('mealName').focus();
					return;
				}

				if (isNaN(mealPrice) || mealPrice <= 0) {
					showNotification('请填写有效的套餐价格', 'error');
					document.getElementById('mealPrice').focus();
					return;
				}

				if (mealTags.length === 0) {
					showNotification('请至少填写一个套餐标签', 'error');
					document.getElementById('mealTags').focus();
					return;
				}

				if (!mealDescription) {
					showNotification('请填写套餐描述', 'error');
					document.getElementById('mealDescription').focus();
					return;
				}

				// 收集选项组
				const optionGroups = [];
				document.querySelectorAll('.option-group-item').forEach((groupElement, index) => {
					const title = groupElement.querySelector('.option-group-title-input').value.trim();
					const rules = groupElement.querySelector('.option-group-rules-input').value.trim();
					const minSelect = parseInt(groupElement.querySelector('.option-group-min-input').value) || 1;
					const maxSelect = parseInt(groupElement.querySelector('.option-group-max-input').value) || 1;
					const repeat = groupElement.querySelector('.option-group-repeat-input').checked;
					const maxPerItem = parseInt(groupElement.querySelector('.option-group-max-per-item-input').value) || (repeat ?
						999 : 1);

					// 验证选项组
					if (!title) {
						showNotification(`选项组 ${index + 1} 的标题不能为空`, 'error');
						groupElement.querySelector('.option-group-title-input').focus();
						throw new Error('选项组标题为空');
					}

					if (!rules) {
						showNotification(`选项组 ${index + 1} 的规则描述不能为空`, 'error');
						groupElement.querySelector('.option-group-rules-input').focus();
						throw new Error('选项组规则为空');
					}

					if (minSelect < 0) {
						showNotification(`选项组 ${index + 1} 的最少选择数量不能小于0`, 'error');
						groupElement.querySelector('.option-group-min-input').focus();
						throw new Error('最小选择数量无效');
					}

					if (maxSelect < minSelect) {
						showNotification(`选项组 ${index + 1} 的最多选择数量不能小于最少选择数量`, 'error');
						groupElement.querySelector('.option-group-max-input').focus();
						throw new Error('最大选择数量无效');
					}

					const items = [];
					groupElement.querySelectorAll('.option-item-list-item').forEach(itemElement => {
						const name = itemElement.querySelector('.option-item-name-input').value.trim();
						const addPrice = parseFloat(itemElement.querySelector('.option-item-price-input').value) || 0;

						if (name) {
							items.push({
								name,
								addPrice
							});
						}
					});

					if (items.length === 0) {
						showNotification(`选项组 ${index + 1} 至少需要一个选项项`, 'error');
						throw new Error('选项组没有选项项');
					}

					optionGroups.push({
						title,
						rules,
						minSelect,
						maxSelect,
						repeat,
						maxPerItem,
						items
					});
				});

				// 收集固定搭配项
				const fixedItems = [];
				document.querySelectorAll('.fixed-item-list-item').forEach((itemElement, index) => {
					const name = itemElement.querySelector('.fixed-item-name-input').value.trim();
					const quantity = parseInt(itemElement.querySelector('.fixed-item-quantity-input').value) || 1;

					if (name) {
						fixedItems.push({
							name,
							quantity
						});
					}
				});

				let meal;
				const now = Date.now();

				if (mealId) {
					// 编辑现有套餐
					meal = meals.find(m => m.id === mealId);
					if (meal) {
						meal.name = mealName;
						meal.price = mealPrice;
						meal.tags = mealTags;
						meal.description = mealDescription;
						meal.active = mealActive;
						meal.optionGroups = optionGroups;
						meal.fixedItems = fixedItems;
						meal.updatedAt = now;
					}
				} else {
					// 创建新套餐
					meal = {
						id: 'meal-' + now + '-' + Math.random().toString(36).substr(2, 9),
						name: mealName,
						price: mealPrice,
						tags: mealTags,
						description: mealDescription,
						active: mealActive,
						optionGroups: optionGroups,
						fixedItems: fixedItems,
						createdAt: now,
						updatedAt: now
					};

					meals.push(meal);
				}

				localStorage.setItem('kfcMeals', JSON.stringify(meals));

				updateHomePage();

				const activeFilter = document.querySelector('.meal-filter-btn.active').dataset.mealFilter;
				updateMealList(activeFilter);

				resetMealForm();

				document.querySelector('.admin-tab[data-tab="meals"]').click();

				showNotification(mealId ? '套餐已更新' : '套餐已添加', 'success');
			}

			// 取消编辑
			function cancelEdit() {
				resetMealForm();
				document.querySelector('.admin-tab[data-tab="meals"]').click();
			}

			// 重置套餐表单
			function resetMealForm() {
				document.getElementById('currentMealId').value = '';
				document.getElementById('mealName').value = '';
				document.getElementById('mealPrice').value = '';
				document.getElementById('mealTags').value = '';
				document.getElementById('mealDescription').value = '';
				document.getElementById('mealActive').checked = true;

				const statusText = document.getElementById('statusText');
				statusText.textContent = '上架';
				statusText.className = 'status-active';

				document.getElementById('optionGroupsManagement').innerHTML = '';
				document.getElementById('fixedItemsManagement').innerHTML = '';
				document.getElementById('addMealTitle').innerHTML = `<i class="fas fa-plus-circle"></i> 添加新套餐`;
				document.getElementById('cancelEditBtn').style.display = 'none';

				addOptionGroup();
			}

			function initImagePreview() {
				const imageModal = document.getElementById('imageModal');
				const modalImage = document.getElementById('modalImage');
				const closeModal = document.getElementById('closeModal');

				closeModal.addEventListener('click', function() {
					imageModal.classList.remove('active');
				});

				imageModal.addEventListener('click', function(e) {
					if (e.target === imageModal) {
						imageModal.classList.remove('active');
					}
				});
			}

			function showFullImage(imageSrc) {
				const modalImage = document.getElementById('modalImage');
				const imageModal = document.getElementById('imageModal');

				modalImage.src = imageSrc;
				imageModal.classList.add('active');
			}

			function updateOrderBadge() {
				const badge = document.getElementById('newOrderBadge');
				if (newOrdersCount > 0) {
					badge.textContent = newOrdersCount > 9 ? '9+' : newOrdersCount;
					badge.style.display = 'flex';
				} else {
					badge.style.display = 'none';
				}
			}

			function showNotification(message, type = 'info') {
				const notification = document.createElement('div');
				notification.textContent = message;
				notification.style.cssText =
					`
		            position: fixed;
		            top: 20px;
		            right: 20px;
		            background-color: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#e31837' : '#e31837'};
		            color: white;
		            padding: 15px 20px;
		            border-radius: 8px;
		            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
		            z-index: 1000;
		            font-weight: bold;
		            animation: slideIn 0.3s ease;
		            max-width: 400px;
		        `;

				const style = document.createElement('style');
				style.textContent =
					`
		            @keyframes slideIn {
		                from { transform: translateX(100%); opacity: 0; }
		                to { transform: translateX(0); opacity: 1; }
		            }
		            @keyframes slideOut {
		                from { transform: translateX(0); opacity: 1; }
		                to { transform: translateX(100%); opacity: 0; }
		            }
		        `;
				document.head.appendChild(style);

				document.body.appendChild(notification);

				setTimeout(() => {
					notification.style.animation = 'slideOut 0.3s ease';
					setTimeout(() => {
						if (notification.parentNode) {
							document.body.removeChild(notification);
						}
					}, 300);
				}, 3000);
			}
			// 其他原有函数保持不变...
		</script>

	</body>
</html>
