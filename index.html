<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <title>è‚¯å¾·åŸºè‡ªåŠ©ç‚¹é¤ç³»ç»Ÿ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”</text></svg>">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.2/dist/av-min.js" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f8f8f8;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            background: linear-gradient(135deg, #e31837 0%, #c8102e 100%);
            color: white;
            padding: 25px 0;
            text-align: center;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 2.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .logo i {
            color: #ffcc00;
        }
        
        .header-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }
        
        .info-item i {
            color: #ffcc00;
        }
        
        .header-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .header-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .header-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        /* é¡µé¢å®¹å™¨ */
        .meal-page-container {
            display: none;
        }
        
        .meal-page-container.active {
            display: block;
        }
        
        /* å¯¼èˆªèœå• */
        .nav-menu {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .nav-title {
            font-size: 1.6rem;
            color: #e31837;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* å¥—é¤ç½‘æ ¼ */
        .meal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .meal-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            border-left: 5px solid #ffcc00;
            display: block;
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }
        
        .meal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .meal-card.inactive {
            opacity: 0.6;
            border-left: 5px solid #ccc;
            position: relative;
        }
        
        .meal-card.inactive:after {
            content: "å·²ä¸‹æ¶";
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f44336;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .meal-card.inactive:hover {
            transform: none;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
            cursor: not-allowed;
        }
        
        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .meal-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #e31837;
        }
        
        .meal-price {
            font-size: 1.6rem;
            font-weight: bold;
            color: #e31837;
        }
        
        .meal-description {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .meal-tag {
            display: inline-block;
            background-color: #ffcc00;
            color: #333;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 8px;
            margin-bottom: 5px;
        }
        
        /* è¿”å›æŒ‰é’® */
        .back-btn {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            margin-bottom: 20px;
            text-decoration: none;
            width: fit-content;
        }
        
        .back-btn:hover {
            background-color: #c8102e;
            transform: scale(1.03);
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }
        
        .menu-section {
            flex: 3;
            min-width: 300px;
        }
        
        .cart-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .section-title {
            font-size: 1.8rem;
            color: #e31837;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #ffcc00;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* é€‰é¡¹ç»„æ ·å¼ */
        .option-group {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #e31837;
        }
        
        .option-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #444;
            font-size: 1.1rem;
        }
        
        .option-rules {
            font-size: 0.9rem;
            color: #e31837;
            margin-bottom: 10px;
            padding: 5px 10px;
            background-color: #ffe6e6;
            border-radius: 4px;
            display: inline-block;
        }
        
        .option-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .option-item {
            background-color: #f5f5f5;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.95rem;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 180px;
            position: relative;
        }
        
        .option-item:hover {
            background-color: #e9e9e9;
        }
        
        .option-item.selected {
            background-color: #e31837;
            color: white;
            border-color: #e31837;
        }
        
        .selection-counter {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }
        
        .counter-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            background-color: white;
            color: #e31837;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .counter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* è´­ç‰©è½¦æ ·å¼ */
        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .cart-item-name {
            flex: 2;
            font-weight: 500;
        }
        
        .cart-item-price {
            flex: 1;
            text-align: right;
            font-weight: bold;
            color: #e31837;
        }
        
        .cart-item-remove {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 10px;
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #eee;
        }
        
        .total-price {
            color: #e31837;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .add-to-cart {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            width: 100%;
            justify-content: center;
            margin-top: 20px;
        }
        
        .add-to-cart:hover:not(:disabled) {
            background-color: #c8102e;
            transform: scale(1.03);
        }
        
        .add-to-cart:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .checkout-btn {
            background-color: #ffcc00;
            color: #333;
            border: none;
            padding: 15px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .checkout-btn:hover:not(:disabled) {
            background-color: #e6b800;
            transform: scale(1.03);
        }
        
        .checkout-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* é…é€è¡¨å• */
        .delivery-form {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .required {
            color: #e31837;
        }
        
        .form-input, .form-select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-input:focus, .form-select:focus, textarea:focus {
            outline: none;
            border-color: #e31837;
            box-shadow: 0 0 0 2px rgba(227, 24, 55, 0.2);
        }
        
        .order-type {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .order-type label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }
        
        .order-type label:hover {
            border-color: #e31837;
        }
        
        .order-type input:checked + span {
            font-weight: bold;
            color: #e31837;
        }
        
        .hidden {
            display: none;
        }
        
        /* æˆ‘çš„è®¢å•é¡µé¢ */
        .my-orders-section {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .user-id-info {
            background-color: #f0f0f0;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-id-label {
            font-weight: bold;
            color: #666;
        }
        
        .user-id-value {
            font-family: monospace;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .orders-search {
            margin-bottom: 20px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .search-btn {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background-color: #c8102e;
        }
        
        .order-filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .order-filter-tab {
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .order-filter-tab:hover {
            background-color: #e0e0e0;
        }
        
        .order-filter-tab.active {
            background-color: #e31837;
            color: white;
        }
        
        .user-order-item {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #ffcc00;
        }
        
        .user-order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .user-order-id {
            font-weight: bold;
            color: #333;
            font-size: 1.2rem;
        }
        
        .user-order-time {
            color: #666;
            font-size: 0.95rem;
        }
        
        .user-order-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .user-status-new {
            background-color: #ffebee;
            color: #e31837;
        }
        
        .user-status-processing {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .user-status-completed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .user-order-items {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .user-order-item-detail {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dashed #eee;
        }
        
        .user-order-item-detail:last-child {
            border-bottom: none;
        }
        
        .user-order-item-name {
            flex: 2;
        }
        
        .user-order-item-price {
            flex: 1;
            text-align: right;
            font-weight: bold;
            color: #e31837;
        }
        
        .user-order-info {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .user-order-total {
            font-weight: bold;
            color: #e31837;
            font-size: 1.2rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #eee;
            text-align: right;
        }
        
        .no-user-orders {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .no-user-orders i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        /* ç®¡ç†å‘˜æŒ‰é’® */
        .admin-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .admin-btn:hover {
            background-color: #555;
            transform: scale(1.05);
        }
        
        .new-order-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #e31837;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* ç®¡ç†å‘˜é¢æ¿ */
        .admin-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 1200px;
            height: 100vh;
            background-color: white;
            z-index: 2000;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
            display: none;
        }
        
        .admin-panel.active {
            transform: translateX(0);
            display: block;
        }
        
        .panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            display: none;
        }
        
        .panel-overlay.active {
            display: block;
        }
        
        .panel-header {
            background: linear-gradient(135deg, #e31837 0%, #c8102e 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .close-panel {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s;
        }
        
        .close-panel:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .panel-content {
            padding: 20px;
        }
        
        .admin-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            color: #666;
            font-weight: 500;
        }
        
        .admin-tab.active {
            color: #e31837;
            border-bottom-color: #e31837;
            font-weight: bold;
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .order-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background-color: #e31837;
            color: white;
        }
        
        .orders-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            min-height: 300px;
        }
        
        .admin-order-item {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #ffcc00;
        }
        
        .order-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .status-new {
            background-color: #ffebee;
            color: #e31837;
        }
        
        .status-processing {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .status-completed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        /* å¯†ç æ¨¡æ€æ¡† */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .password-modal.active {
            display: flex;
        }
        
        .password-box {
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .password-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .password-btn {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .password-error {
            color: #e31837;
            margin-top: 15px;
            font-weight: bold;
            display: none;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading-message {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading-message i {
            font-size: 3rem;
            color: #e31837;
            margin-bottom: 15px;
        }
        
        .no-meals-message, .no-orders {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            background-color: #f9f9f9;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }
        
        .no-meals-message i, .no-orders i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        /* å›ºå®šæ­é… */
        .fixed-combo-items {
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .fixed-combo-item {
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* çŠ¶æ€åˆ‡æ¢ */
        .status-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .status-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .status-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .status-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .status-slider {
            background-color: #4CAF50;
        }
        
        input:checked + .status-slider:before {
            transform: translateX(30px);
        }
        
        /* å¥—é¤ç®¡ç† */
        .meal-list {
            margin-bottom: 30px;
        }
        
        .meal-list-item {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #e31837;
        }
        
        .meal-list-item-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .edit-btn {
            background-color: #ffcc00;
            color: #333;
        }
        
        .delete-btn {
            background-color: #e31837;
            color: white;
        }
        
        .add-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        /* é€‰ä¸­çŠ¶æ€ */
        .selection-status {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
            padding: 5px 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            display: inline-block;
        }
        
        .selection-status.valid {
            background-color: #e6f7e6;
            color: #2e7d32;
        }
        
        .selection-status.invalid {
            background-color: #ffebee;
            color: #c62828;
        }
        
        /* æˆªå›¾æŸ¥çœ‹æ¨¡æ€æ¡† */
        .screenshot-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .screenshot-modal.active {
            display: flex;
        }
        
        .screenshot-modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            max-height: 90vh;
            text-align: center;
            position: relative;
        }
        
        .close-screenshot {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e31837;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }
        
        .screenshot-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .screenshot-actions {
            margin-top: 15px;
        }
        
        /* æˆªå›¾æŸ¥çœ‹æŒ‰é’®æ ·å¼ */
        .view-screenshot-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }
        
        .view-screenshot-btn:hover {
            background-color: #45a049;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .cart-section {
                position: static;
            }
            
            .logo {
                font-size: 2rem;
            }
            
            .meal-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-panel {
                width: 100%;
            }
            
            .orders-container {
                grid-template-columns: 1fr;
            }
            
            .admin-btn span {
                display: none;
            }
            
            .admin-btn {
                padding: 15px;
                border-radius: 50%;
                width: 60px;
                height: 60px;
                justify-content: center;
            }
            
            .option-items {
                flex-direction: column;
            }
            
            .option-item {
                min-width: 100%;
                justify-content: space-between;
            }
            
            .header-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .header-btn {
                width: 200px;
                justify-content: center;
            }
        }
        
        /* é¡µè„š */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
        }
        
        /* æˆªå›¾ä¸Šä¼  */
        .screenshot-upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }
        
        .screenshot-upload-area:hover {
            border-color: #e31837;
            background-color: #fff5f5;
        }
        
        .screenshot-preview {
            position: relative;
            margin-top: 15px;
            max-width: 300px;
        }
        
        .screenshot-preview img {
            width: 100%;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .remove-screenshot {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e31837;
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .info-method-selector {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .method-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .method-option:hover {
            border-color: #e31837;
        }
        
        /* å¥—é¤ç­›é€‰å™¨ */
        .meal-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .meal-filter-btn {
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .meal-filter-btn.active {
            background-color: #e31837;
            color: white;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-utensils"></i>
                <h1>è‚¯å¾·åŸºè‡ªåŠ©ç‚¹é¤ç³»ç»Ÿ</h1>
                <i class="fas fa-hamburger"></i>
            </div>
            <p>å®…æ€¥é€å…é…é€è´¹ | å¤šäººé¤å›¢é¤ä¼˜æƒ  | å¤–é€åˆ°å®¶</p>
            <div class="header-info">
                <div class="info-item">
                    <i class="fas fa-shipping-fast"></i>
                    <span>å®…æ€¥é€å…é…é€è´¹</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-users"></i>
                    <span>å¤šäººé¤å›¢é¤ä¼˜æƒ </span>
                </div>
                <div class="info-item">
                    <i class="fas fa-store"></i>
                    <span>åˆ°åº—è‡ªæ</span>
                </div>
            </div>
            <div class="header-buttons">
                <button class="header-btn" id="viewOrdersBtn">
                    <i class="fas fa-clipboard-list"></i>
                    æŸ¥çœ‹æˆ‘çš„è®¢å•
                </button>
                <button class="header-btn" id="viewHomeBtn" style="display: none;">
                    <i class="fas fa-home"></i>
                    è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹å®¹å™¨ -->
    <div class="container">
        <!-- é¦–é¡µ -->
        <div id="homePage" class="meal-page-container active">
            <div class="nav-menu">
                <h2 class="nav-title">
                    <i class="fas fa-utensils"></i>
                    é€‰æ‹©æ‚¨æƒ³è¦çš„å¥—é¤
                </h2>
                <div class="instructions">
                    <p><strong>ä¸‹å•æ­¥éª¤ï¼š</strong></p>
                    <ol>
                        <li>é€‰æ‹©æ‚¨æƒ³è¦çš„å¥—é¤</li>
                        <li>åœ¨å¥—é¤ä¸­é€‰æ‹©å…·ä½“çš„æ±‰å ¡ã€å°åƒå’Œé¥®å“ï¼ˆç‚¹å‡»é€‰é¡¹ï¼Œä½¿ç”¨+/-æŒ‰é’®è°ƒæ•´æ•°é‡ï¼‰</li>
                        <li>ç¡®ä¿æ¯ä¸ªé€‰é¡¹ç»„çš„é€‰æ‹©æ•°é‡ç¬¦åˆè¦æ±‚ï¼ˆä¼šæœ‰æç¤ºï¼‰</li>
                        <li>ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®</li>
                        <li>åœ¨å³ä¾§è´­ç‰©è½¦ç¡®è®¤è®¢å•å¹¶é€‰æ‹©é…é€æ–¹å¼</li>
                        <li>æäº¤è®¢å•å®Œæˆè´­ä¹°</li>
                        <li>æäº¤åå¯ä»¥ç‚¹å‡»ä¸Šæ–¹"æŸ¥çœ‹æˆ‘çš„è®¢å•"æŸ¥çœ‹è®¢å•çŠ¶æ€</li>
                    </ol>
                </div>
            </div>
            <div class="meal-grid" id="mealGrid">
                <div class="loading-message" id="loadingMeals">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>æ­£åœ¨åŠ è½½å¥—é¤...</p>
                </div>
            </div>
            <div class="no-meals-message" id="noMealsMessage" style="display: none;">
                <i class="fas fa-utensils"></i>
                <h3>æš‚æ— å¥—é¤</h3>
                <p>è¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ å¥—é¤</p>
            </div>
        </div>

        <!-- å¥—é¤è¯¦æƒ…é¡µ -->
        <div id="mealDetailPage" class="meal-page-container">
            <!-- å†…å®¹å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
        </div>

        <!-- æˆ‘çš„è®¢å•é¡µ -->
        <div id="myOrdersPage" class="meal-page-container">
            <button class="back-btn" onclick="KFCSystem.showPage('homePage')">
                <i class="fas fa-arrow-left"></i>
                è¿”å›å¥—é¤åˆ—è¡¨
            </button>
            <div class="my-orders-section">
                <h2 class="section-title">
                    <i class="fas fa-clipboard-list"></i>
                    æˆ‘çš„è®¢å•
                </h2>
                <div class="user-id-info">
                    <div class="user-id-label">æ‚¨çš„ç”¨æˆ·æ ‡è¯†ç¬¦ï¼š</div>
                    <div class="user-id-value" id="currentUserIdDisplay"></div>
                </div>
                <div class="orders-search">
                    <div class="search-box">
                        <input type="text" class="search-input" id="orderSearchInput" placeholder="è¾“å…¥è®¢å•å·æœç´¢...">
                        <button class="search-btn" id="orderSearchBtn">æœç´¢</button>
                    </div>
                    <div class="order-filter-tabs">
                        <button class="order-filter-tab active" data-order-filter="all">å…¨éƒ¨è®¢å•</button>
                        <button class="order-filter-tab" data-order-filter="new">æ–°è®¢å•</button>
                        <button class="order-filter-tab" data-order-filter="processing">å¤„ç†ä¸­</button>
                        <button class="order-filter-tab" data-order-filter="completed">å·²å®Œæˆ</button>
                    </div>
                </div>
                <div id="myOrdersContainer">
                    <div class="loading-message" id="loadingOrders">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>æ­£åœ¨åŠ è½½è®¢å•...</p>
                    </div>
                </div>
                <div class="no-user-orders" id="noUserOrdersMessage" style="display: none;">
                    <i class="fas fa-box-open"></i>
                    <h3>æš‚æ— è®¢å•</h3>
                    <p>æ‚¨è¿˜æ²¡æœ‰æäº¤è¿‡è®¢å•ï¼Œå¿«å»ä¸‹å•å§ï¼</p>
                </div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <div class="footer">
            <p>Â© 2023 è‚¯å¾·åŸºè‡ªåŠ©ç‚¹é¤ç³»ç»Ÿ | å®…æ€¥é€å…é…é€è´¹ | å•†å“ç‰¹æ®Šå”®å‡ºä¸é€€ä¸æ¢</p>
            <p>#æ˜¥æ—¥å‡ºæ¸¸å¿…å¤‡ #åƒé¸¡ç¥å™¨</p>
        </div>
    </div>

    <!-- ç®¡ç†å‘˜æŒ‰é’® -->
    <button class="admin-btn" id="adminBtn">
        <i class="fas fa-user-shield"></i>
        <span>åå°ç®¡ç†</span>
        <div class="new-order-badge" id="newOrderBadge" style="display: none;">0</div>
    </button>

    <!-- å¯†ç æ¨¡æ€æ¡† -->
    <div class="password-modal" id="passwordModal">
        <div class="password-box">
            <h3><i class="fas fa-lock"></i> ç®¡ç†å‘˜ç™»å½•</h3>
            <input type="password" class="password-input" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            <div class="password-error" id="passwordError">å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼</div>
            <button class="password-btn" id="submitPassword">ç¡®è®¤</button>
        </div>
    </div>

    <!-- é¢æ¿é®ç½©å±‚ -->
    <div class="panel-overlay" id="panelOverlay"></div>

    <!-- ç®¡ç†å‘˜é¢æ¿ -->
    <div class="admin-panel" id="adminPanel">
        <div class="panel-header">
            <h2><i class="fas fa-clipboard-list"></i> ç³»ç»Ÿç®¡ç†åå°</h2>
            <button class="close-panel" id="closePanel">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-content">
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="orders">è®¢å•ç®¡ç†</button>
                <button class="admin-tab" data-tab="meals">å¥—é¤ç®¡ç†</button>
                <button class="admin-tab" data-tab="addMeal">æ·»åŠ å¥—é¤</button>
            </div>
            
            <div id="ordersTab" class="admin-tab-content active">
                <div class="order-filters">
                    <button class="filter-btn active" data-filter="all">å…¨éƒ¨è®¢å•</button>
                    <button class="filter-btn" data-filter="new">æ–°è®¢å•</button>
                    <button class="filter-btn" data-filter="processing">å¤„ç†ä¸­</button>
                    <button class="filter-btn" data-filter="completed">å·²å®Œæˆ</button>
                    <button class="filter-btn" id="clearAllOrders">æ¸…ç©ºæ‰€æœ‰è®¢å•</button>
                </div>
                <div class="orders-container" id="ordersContainer">
                    <div class="loading-message" id="loadingAdminOrders">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>æ­£åœ¨åŠ è½½è®¢å•...</p>
                    </div>
                    <div class="no-orders" id="noOrdersMessage" style="display: none;">
                        <i class="fas fa-box-open"></i>
                        <h3>æš‚æ— è®¢å•</h3>
                        <p>å½“é¡¾å®¢æäº¤è®¢å•åï¼Œè®¢å•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                </div>
            </div>
            
            <div id="mealsTab" class="admin-tab-content">
                <div class="meal-filters">
                    <button class="meal-filter-btn active" data-meal-filter="all">å…¨éƒ¨å¥—é¤</button>
                    <button class="meal-filter-btn" data-meal-filter="active">å·²ä¸Šæ¶</button>
                    <button class="meal-filter-btn" data-meal-filter="inactive">å·²ä¸‹æ¶</button>
                </div>
                <div class="meal-list" id="mealList">
                    <div class="loading-message" id="loadingAdminMeals">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>æ­£åœ¨åŠ è½½å¥—é¤...</p>
                    </div>
                </div>
                <div class="no-meals-message" id="noMealsAdminMessage" style="display: none;">
                    <i class="fas fa-utensils"></i>
                    <h3>æš‚æ— å¥—é¤</h3>
                    <p>ç‚¹å‡»"æ·»åŠ å¥—é¤"æ ‡ç­¾åˆ›å»ºæ–°å¥—é¤</p>
                </div>
            </div>
            
            <div id="addMealTab" class="admin-tab-content">
                <h3 class="section-title" id="addMealTitle">
                    <i class="fas fa-plus-circle"></i>
                    æ·»åŠ æ–°å¥—é¤
                </h3>
                <div class="meal-form">
                    <input type="hidden" id="currentMealId" value="">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">å¥—é¤åç§° <span class="required">*</span></label>
                            <input type="text" class="form-input" id="mealName" placeholder="ä¾‹å¦‚ï¼šã€12-8ã€‘è‡ªæ/å®…æ€¥é€12ä»¶å¥—89.9å…ƒ" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¥—é¤ä»·æ ¼ <span class="required">*</span></label>
                            <input type="number" class="form-input" id="mealPrice" placeholder="ä¾‹å¦‚ï¼š89.9" min="0" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">å¥—é¤æ ‡ç­¾ <span class="required">*</span></label>
                            <input type="text" class="form-input" id="mealTags" placeholder="ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šè‡ªæ/å®…æ€¥é€,3äººé¤,12ä»¶å¥—" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¥—é¤æè¿° <span class="required">*</span></label>
                            <input type="text" class="form-input" id="mealDescription" placeholder="ä¾‹å¦‚ï¼šé€‚åˆ3äººäº«ç”¨ï¼Œè‡ªæ/å®…æ€¥é€éƒ½å¯ç”¨" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">å¥—é¤çŠ¶æ€</label>
                            <div class="status-label">
                                <label class="status-toggle">
                                    <input type="checkbox" id="mealActive" checked>
                                    <span class="status-slider"></span>
                                </label>
                                <span id="statusText" class="status-active">ä¸Šæ¶</span>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 30px; display: flex; gap: 15px;">
                        <button class="add-btn action-btn" id="saveMealBtn" style="padding: 12px 30px;">
                            <i class="fas fa-save"></i>
                            ä¿å­˜å¥—é¤
                        </button>
                        <button class="filter-btn" id="cancelEditBtn" style="padding: 12px 30px; display: none;">
                            <i class="fas fa-times"></i>
                            å–æ¶ˆç¼–è¾‘
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æˆªå›¾æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div class="screenshot-modal" id="screenshotModal">
        <div class="screenshot-modal-content">
            <button class="close-screenshot" onclick="KFCSystem.closeScreenshot()">
                <i class="fas fa-times"></i>
            </button>
            <div class="screenshot-title">é—¨åº—æˆªå›¾</div>
            <img id="screenshotImage" src="" alt="é—¨åº—æˆªå›¾" style="max-width: 100%; max-height: 70vh; border-radius: 5px;">
            <div class="screenshot-actions">
                <button class="filter-btn" onclick="KFCSystem.downloadScreenshot()" style="margin-top: 10px;">
                    <i class="fas fa-download"></i>
                    ä¸‹è½½æˆªå›¾
                </button>
            </div>
        </div>
    </div>

    <script>
        // è‚¯å¾·åŸºè‡ªåŠ©ç‚¹é¤ç³»ç»Ÿ - ä¿®å¤ç‰ˆ
        // ä¿®å¤å†…å®¹ï¼š
        // 1. è®¢å•çŠ¶æ€æ›´æ–°æ˜¾ç¤ºé—®é¢˜
        // 2. æˆªå›¾æŸ¥çœ‹åŠŸèƒ½
        // 3. æ•°æ®åŒæ­¥é—®é¢˜
        
        const KFCSystem = {
            // é…ç½®
            config: {
                leancloud: {
                    appId: "O7ZlYWWPH4VR5qNRR5ca1cNr-gzGzoHsz",
                    appKey: "1IWefE69Z5Ppxe6wSK5iBlLL",
                    serverURLs: "https://o7zlywwp.lc-cn-n1-shared.com"
                },
                adminPassword: "200104"
            },
            
            // æ•°æ®çŠ¶æ€
            data: {
                meals: [],
                orders: [],
                currentUser: null,
                currentCart: [],
                currentMeal: null,
                selectedOptions: {},
                newOrdersCount: 0,
                editingMeal: null,
                isCloudAvailable: false
            },
            
            // åˆå§‹åŒ–
            async init() {
                console.log("ğŸš€ åˆå§‹åŒ–è‚¯å¾·åŸºç‚¹é¤ç³»ç»Ÿ...");
                
                // åˆå§‹åŒ–LeanCloud
                this.initLeanCloud();
                
                // åˆå§‹åŒ–ç”¨æˆ·
                this.initUser();
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
                this.initEventListeners();
                
                // åŠ è½½æ•°æ®
                await this.loadData();
                
                // æ›´æ–°æ–°è®¢å•å¾½ç« 
                this.updateOrderBadge();
                
                console.log("âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ");
            },
            
            // åˆå§‹åŒ–LeanCloud
            initLeanCloud() {
                try {
                    if (typeof AV !== 'undefined') {
                        AV.init(this.config.leancloud);
                        AV.debug.enable();
                        console.log("âœ… LeanCloudåˆå§‹åŒ–æˆåŠŸ");
                        this.data.isCloudAvailable = true;
                        return true;
                    } else {
                        console.warn("âš ï¸ LeanCloud SDKæœªåŠ è½½ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼");
                        this.data.isCloudAvailable = false;
                        return false;
                    }
                } catch (error) {
                    console.error("âŒ LeanCloudåˆå§‹åŒ–å¤±è´¥:", error);
                    this.data.isCloudAvailable = false;
                    return false;
                }
            },
            
            // åˆå§‹åŒ–ç”¨æˆ·
            initUser() {
                let userId = localStorage.getItem('kfcUserId');
                if (!userId) {
                    userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('kfcUserId', userId);
                }
                
                this.data.currentUser = {
                    id: userId,
                    name: 'é¡¾å®¢'
                };
                
                // æ˜¾ç¤ºç”¨æˆ·ID
                const displayEl = document.getElementById('currentUserIdDisplay');
                if (displayEl) {
                    displayEl.textContent = userId.substring(0, 12) + '...';
                }
            },
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners() {
                // å¤´éƒ¨æŒ‰é’®
                document.getElementById('viewOrdersBtn').addEventListener('click', () => {
                    this.showMyOrdersPage();
                });
                
                document.getElementById('viewHomeBtn').addEventListener('click', () => {
                    this.showPage('homePage');
                });
                
                // ç®¡ç†å‘˜æŒ‰é’®
                document.getElementById('adminBtn').addEventListener('click', () => {
                    this.showPasswordModal();
                });
                
                // å¯†ç éªŒè¯
                document.getElementById('submitPassword').addEventListener('click', () => {
                    this.verifyAdminPassword();
                });
                
                document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.verifyAdminPassword();
                    }
                });
                
                // å…³é—­ç®¡ç†å‘˜é¢æ¿
                document.getElementById('closePanel').addEventListener('click', () => {
                    this.closeAdminPanel();
                });
                
                document.getElementById('panelOverlay').addEventListener('click', () => {
                    this.closeAdminPanel();
                });
                
                // æ¸…ç©ºæ‰€æœ‰è®¢å•
                document.getElementById('clearAllOrders').addEventListener('click', () => {
                    this.clearAllOrders();
                });
                
                // ç®¡ç†å‘˜æ ‡ç­¾é¡µ
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.target.dataset.tab;
                        this.switchAdminTab(tabId);
                    });
                });
                
                // è®¢å•ç­›é€‰
                document.querySelectorAll('.filter-btn[data-filter]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const filter = e.target.dataset.filter;
                        this.renderAdminOrders(filter);
                        
                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        document.querySelectorAll('.filter-btn[data-filter]').forEach(b => {
                            b.classList.remove('active');
                        });
                        e.target.classList.add('active');
                    });
                });
                
                // å¥—é¤ç­›é€‰
                document.querySelectorAll('.meal-filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const filter = e.target.dataset.mealFilter;
                        this.updateMealList(filter);
                        
                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        document.querySelectorAll('.meal-filter-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        e.target.classList.add('active');
                    });
                });
                
                // è®¢å•æœç´¢
                document.getElementById('orderSearchBtn').addEventListener('click', () => {
                    this.searchUserOrders();
                });
                
                document.getElementById('orderSearchInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.searchUserOrders();
                    }
                });
                
                // è®¢å•ç­›é€‰æ ‡ç­¾
                document.querySelectorAll('.order-filter-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const filter = e.target.dataset.orderFilter;
                        this.renderUserOrders(filter);
                        
                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        document.querySelectorAll('.order-filter-tab').forEach(t => {
                            t.classList.remove('active');
                        });
                        e.target.classList.add('active');
                    });
                });
                
                // å¥—é¤çŠ¶æ€åˆ‡æ¢
                document.getElementById('mealActive')?.addEventListener('change', (e) => {
                    const statusText = document.getElementById('statusText');
                    if (e.target.checked) {
                        statusText.textContent = 'ä¸Šæ¶';
                        statusText.className = 'status-active';
                    } else {
                        statusText.textContent = 'ä¸‹æ¶';
                        statusText.className = 'status-inactive';
                    }
                });
                
                // ä¿å­˜å¥—é¤
                document.getElementById('saveMealBtn')?.addEventListener('click', () => {
                    this.saveMeal();
                });
                
                // å–æ¶ˆç¼–è¾‘
                document.getElementById('cancelEditBtn')?.addEventListener('click', () => {
                    this.cancelEditMeal();
                });
            },
            
            // åŠ è½½æ•°æ®
            async loadData() {
                console.log("ğŸ“¥ å¼€å§‹åŠ è½½æ•°æ®...");
                
                try {
                    // å°è¯•ä»LeanCloudåŠ è½½æ•°æ®
                    if (this.data.isCloudAvailable) {
                        await Promise.all([
                            this.loadMealsFromCloud(),
                            this.loadOrdersFromCloud()
                        ]);
                    } else {
                        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
                        this.loadFromLocalStorage();
                    }
                    
                    // æ›´æ–°é¦–é¡µ
                    this.updateHomePage();
                    
                } catch (error) {
                    console.error("âŒ åŠ è½½æ•°æ®å¤±è´¥:", error);
                    this.showNotification("åŠ è½½æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜", "error");
                    
                    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®ä½œä¸ºé™çº§æ–¹æ¡ˆ
                    this.loadFromLocalStorage();
                    this.updateHomePage();
                }
            },
            
            // ä»LeanCloudåŠ è½½å¥—é¤æ•°æ®
            async loadMealsFromCloud() {
                try {
                    console.log("â˜ï¸ ä»LeanCloudåŠ è½½å¥—é¤æ•°æ®...");
                    
                    const Meal = AV.Object.extend('Meal');
                    const query = new AV.Query('Meal');
                    query.descending('createdAt');
                    
                    const results = await query.find();
                    console.log(`âœ… ä»LeanCloudåŠ è½½åˆ° ${results.length} ä¸ªå¥—é¤`);
                    
                    this.data.meals = results.map(mealObj => {
                        const meal = mealObj.toJSON();
                        meal.objectId = mealObj.id;
                        meal.createdAt = mealObj.createdAt;
                        meal.updatedAt = mealObj.updatedAt;
                        return meal;
                    });
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä½œä¸ºç¼“å­˜
                    localStorage.setItem('kfcMeals', JSON.stringify(this.data.meals));
                    
                    return this.data.meals;
                } catch (error) {
                    console.error("âŒ ä»LeanCloudåŠ è½½å¥—é¤æ•°æ®å¤±è´¥:", error);
                    throw error;
                }
            },
            
            // ä»LeanCloudåŠ è½½è®¢å•æ•°æ® - ä¿®å¤ç‰ˆï¼ˆç¡®ä¿æˆªå›¾æ•°æ®æ­£ç¡®åŠ è½½ï¼‰
            async loadOrdersFromCloud() {
                try {
                    console.log("â˜ï¸ ä»LeanCloudåŠ è½½è®¢å•æ•°æ®...");
                    
                    const Order = AV.Object.extend('Order');
                    const query = new AV.Query('Order');
                    query.descending('createdAt');
                    
                    const results = await query.find();
                    console.log(`âœ… ä»LeanCloudåŠ è½½åˆ° ${results.length} ä¸ªè®¢å•`);
                    
                    this.data.orders = results.map(orderObj => {
                        const order = orderObj.toJSON();
                        order.objectId = orderObj.id;
                        // ç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½æ­£ç¡®æå–
                        order.id = order.get('orderId') || order.objectId;
                        order.timestamp = order.get('timestamp') || new Date(order.createdAt).toLocaleString('zh-CN');
                        order.status = order.get('status') || 'new';
                        order.items = order.get('items') || [];
                        order.deliveryInfo = order.get('deliveryInfo') || {};
                        order.deliveryType = order.get('deliveryType') || 'delivery';
                        order.orderNote = order.get('orderNote') || '';
                        order.totalPrice = order.get('totalPrice') || 0;
                        order.hasScreenshot = order.get('hasScreenshot') || false;
                        order.screenshotData = order.get('screenshotData') || '';
                        order.userId = order.get('userId') || 'unknown';
                        order.mealName = order.get('mealName') || 'æœªçŸ¥å¥—é¤';
                        
                        return order;
                    });
                    
                    // è®¡ç®—æ–°è®¢å•æ•°é‡
                    this.data.newOrdersCount = this.data.orders.filter(order => order.status === 'new').length;
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä½œä¸ºç¼“å­˜
                    localStorage.setItem('kfcOrders', JSON.stringify(this.data.orders));
                    localStorage.setItem('newOrdersCount', this.data.newOrdersCount);
                    
                    return this.data.orders;
                } catch (error) {
                    console.error("âŒ ä»LeanCloudåŠ è½½è®¢å•æ•°æ®å¤±è´¥:", error);
                    throw error;
                }
            },
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadFromLocalStorage() {
                console.log("ğŸ’¾ ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®...");
                
                // åŠ è½½å¥—é¤æ•°æ®
                const localMeals = JSON.parse(localStorage.getItem('kfcMeals')) || [];
                if (localMeals.length > 0) {
                    this.data.meals = localMeals;
                } else {
                    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ›å»ºç¤ºä¾‹å¥—é¤
                    this.createSampleMeals();
                }
                
                // åŠ è½½è®¢å•æ•°æ®
                const localOrders = JSON.parse(localStorage.getItem('kfcOrders')) || [];
                if (localOrders.length > 0) {
                    this.data.orders = localOrders;
                }
                
                // åŠ è½½æ–°è®¢å•è®¡æ•°
                this.data.newOrdersCount = parseInt(localStorage.getItem('newOrdersCount')) || 0;
            },
            
            // åˆ›å»ºç¤ºä¾‹å¥—é¤
            createSampleMeals() {
                this.data.meals = [
                    {
                        id: 'meal_1',
                        objectId: 'meal_1',
                        name: 'ã€12-8ã€‘è‡ªæ/å®…æ€¥é€12ä»¶å¥—89.9å…ƒ',
                        price: 89.9,
                        tags: ['è‡ªæ/å®…æ€¥é€', '3äººé¤', '12ä»¶å¥—'],
                        description: 'é€‚åˆ3äººäº«ç”¨ï¼Œè‡ªæ/å®…æ€¥é€éƒ½å¯ç”¨',
                        active: true,
                        optionGroups: [
                            {
                                title: 'ä¸»é£Ÿï¼ˆæ±‰å ¡/å·ï¼‰',
                                rules: 'è¯·é€‰æ‹©3ç§ï¼Œæ¯ç§æœ€å¤š2ä¸ª',
                                minSelect: 3,
                                maxSelect: 3,
                                repeat: true,
                                maxPerItem: 2,
                                items: [
                                    { name: 'é¦™è¾£é¸¡è…¿å ¡', addPrice: 0 },
                                    { name: 'æ–°å¥¥å°”è‰¯çƒ¤é¸¡è…¿å ¡', addPrice: 0 },
                                    { name: 'åŠ²è„†é¸¡è…¿å ¡', addPrice: 0 },
                                    { name: 'è€åŒ—äº¬é¸¡è‚‰å·', addPrice: 0 }
                                ]
                            },
                            {
                                title: 'å°åƒ',
                                rules: 'è¯·é€‰æ‹©2ç§ï¼Œæ¯ç§æœ€å¤š2ä¸ª',
                                minSelect: 2,
                                maxSelect: 2,
                                repeat: true,
                                maxPerItem: 2,
                                items: [
                                    { name: 'ä¸Šæ ¡é¸¡å—ï¼ˆ5å—ï¼‰', addPrice: 0 },
                                    { name: 'è–¯æ¡ï¼ˆä¸­ï¼‰', addPrice: 0 },
                                    { name: 'é»„é‡‘é¸¡æŸ³', addPrice: 1 },
                                    { name: 'è‘¡å¼è›‹æŒ', addPrice: 2 }
                                ]
                            },
                            {
                                title: 'é¥®å“',
                                rules: 'è¯·é€‰æ‹©3æ¯',
                                minSelect: 3,
                                maxSelect: 3,
                                repeat: true,
                                items: [
                                    { name: 'å¯ä¹ï¼ˆä¸­ï¼‰', addPrice: 0 },
                                    { name: 'ä¸ƒå–œï¼ˆä¸­ï¼‰', addPrice: 0 },
                                    { name: 'ç¾æ±æºæ©™æ±', addPrice: 0 },
                                    { name: 'å¥¶èŒ¶', addPrice: 1 }
                                ]
                            }
                        ],
                        fixedItems: [],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'meal_2',
                        objectId: 'meal_2',
                        name: 'ã€6-6ã€‘è‡ªæ/å®…æ€¥é€6ä»¶å¥—45.9å…ƒ',
                        price: 45.9,
                        tags: ['è‡ªæ/å®…æ€¥é€', '2äººé¤', '6ä»¶å¥—'],
                        description: 'é€‚åˆ2äººäº«ç”¨ï¼Œç»æµå®æƒ ',
                        active: true,
                        optionGroups: [
                            {
                                title: 'ä¸»é£Ÿ',
                                rules: 'è¯·é€‰æ‹©2ç§',
                                minSelect: 2,
                                maxSelect: 2,
                                items: [
                                    { name: 'é¦™è¾£é¸¡è…¿å ¡', addPrice: 0 },
                                    { name: 'æ–°å¥¥å°”è‰¯çƒ¤é¸¡è…¿å ¡', addPrice: 0 }
                                ]
                            },
                            {
                                title: 'å°åƒ',
                                rules: 'è¯·é€‰æ‹©2ç§',
                                minSelect: 2,
                                maxSelect: 2,
                                items: [
                                    { name: 'ä¸Šæ ¡é¸¡å—ï¼ˆ5å—ï¼‰', addPrice: 0 },
                                    { name: 'è–¯æ¡ï¼ˆä¸­ï¼‰', addPrice: 0 }
                                ]
                            },
                            {
                                title: 'é¥®å“',
                                rules: 'è¯·é€‰æ‹©2æ¯',
                                minSelect: 2,
                                maxSelect: 2,
                                items: [
                                    { name: 'å¯ä¹ï¼ˆä¸­ï¼‰', addPrice: 0 },
                                    { name: 'ä¸ƒå–œï¼ˆä¸­ï¼‰', addPrice: 0 }
                                ]
                            }
                        ],
                        fixedItems: [
                            { name: 'åŸå‘³é¸¡ï¼ˆå—ï¼‰', quantity: 1 }
                        ],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'meal_3',
                        objectId: 'meal_3',
                        name: 'ã€20-15ã€‘è‡ªæ/å®…æ€¥é€20ä»¶å¥—158å…ƒ',
                        price: 158,
                        tags: ['è‡ªæ/å®…æ€¥é€', '5-6äººé¤', '20ä»¶å¥—'],
                        description: 'é€‚åˆ5-6äººèšä¼šäº«ç”¨',
                        active: true,
                        optionGroups: [
                            {
                                title: 'ä¸»é£Ÿ',
                                rules: 'è¯·é€‰æ‹©6ç§',
                                minSelect: 6,
                                maxSelect: 6,
                                items: [
                                    { name: 'é¦™è¾£é¸¡è…¿å ¡', addPrice: 0 },
                                    { name: 'æ–°å¥¥å°”è‰¯çƒ¤é¸¡è…¿å ¡', addPrice: 0 },
                                    { name: 'åŠ²è„†é¸¡è…¿å ¡', addPrice: 0 },
                                    { name: 'è€åŒ—äº¬é¸¡è‚‰å·', addPrice: 0 }
                                ]
                            },
                            {
                                title: 'å°åƒ',
                                rules: 'è¯·é€‰æ‹©8ç§',
                                minSelect: 8,
                                maxSelect: 8,
                                items: [
                                    { name: 'ä¸Šæ ¡é¸¡å—ï¼ˆ5å—ï¼‰', addPrice: 0 },
                                    { name: 'è–¯æ¡ï¼ˆä¸­ï¼‰', addPrice: 0 },
                                    { name: 'é»„é‡‘é¸¡æŸ³', addPrice: 1 },
                                    { name: 'è‘¡å¼è›‹æŒ', addPrice: 2 }
                                ]
                            },
                            {
                                title: 'é¥®å“',
                                rules: 'è¯·é€‰æ‹©6æ¯',
                                minSelect: 6,
                                maxSelect: 6,
                                items: [
                                    { name: 'å¯ä¹ï¼ˆä¸­ï¼‰', addPrice: 0 },
                                    { name: 'ä¸ƒå–œï¼ˆä¸­ï¼‰', addPrice: 0 },
                                    { name: 'ç¾æ±æºæ©™æ±', addPrice: 0 },
                                    { name: 'å¥¶èŒ¶', addPrice: 1 }
                                ]
                            }
                        ],
                        fixedItems: [],
                        createdAt: new Date().toISOString()
                    }
                ];
                
                this.saveMealsToLocal();
            },
            
            // ä¿å­˜å¥—é¤åˆ°æœ¬åœ°å­˜å‚¨
            saveMealsToLocal() {
                localStorage.setItem('kfcMeals', JSON.stringify(this.data.meals));
            },
            
            // ä¿å­˜å¥—é¤åˆ°LeanCloud
            async saveMealToCloud(mealData) {
                if (!this.data.isCloudAvailable) {
                    return this.saveMealToLocal(mealData);
                }
                
                try {
                    console.log("â˜ï¸ ä¿å­˜å¥—é¤åˆ°LeanCloud:", mealData.name);
                    
                    let mealObject;
                    
                    if (mealData.objectId && !mealData.objectId.startsWith('meal_')) {
                        // æ›´æ–°ç°æœ‰å¥—é¤ï¼ˆäº‘ç«¯å·²æœ‰çš„å¥—é¤ï¼‰
                        mealObject = AV.Object.createWithoutData('Meal', mealData.objectId);
                        
                        // è®¾ç½®æ›´æ–°å­—æ®µ
                        mealObject.set('name', mealData.name);
                        mealObject.set('price', mealData.price);
                        mealObject.set('tags', mealData.tags);
                        mealObject.set('description', mealData.description);
                        mealObject.set('active', mealData.active);
                        mealObject.set('optionGroups', mealData.optionGroups || []);
                        mealObject.set('fixedItems', mealData.fixedItems || []);
                        
                        await mealObject.save();
                        console.log("âœ… å¥—é¤æ›´æ–°æˆåŠŸ");
                    } else {
                        // åˆ›å»ºæ–°å¥—é¤
                        mealObject = new (AV.Object.extend('Meal'))();
                        
                        mealObject.set('name', mealData.name);
                        mealObject.set('price', mealData.price);
                        mealObject.set('tags', mealData.tags);
                        mealObject.set('description', mealData.description);
                        mealObject.set('active', mealData.active !== false);
                        mealObject.set('optionGroups', mealData.optionGroups || []);
                        mealObject.set('fixedItems', mealData.fixedItems || []);
                        
                        await mealObject.save();
                        mealData.objectId = mealObject.id;
                        mealData.createdAt = mealObject.get('createdAt');
                        mealData.updatedAt = mealObject.get('updatedAt');
                        console.log("âœ… å¥—é¤åˆ›å»ºæˆåŠŸï¼ŒID:", mealObject.id);
                    }
                    
                    return mealData;
                } catch (error) {
                    console.error("âŒ ä¿å­˜å¥—é¤åˆ°LeanCloudå¤±è´¥:", error);
                    return this.saveMealToLocal(mealData);
                }
            },
            
            // ä¿å­˜å¥—é¤åˆ°æœ¬åœ°å­˜å‚¨
            saveMealToLocal(mealData) {
                console.log("ğŸ’¾ ä¿å­˜å¥—é¤åˆ°æœ¬åœ°å­˜å‚¨:", mealData.name);
                
                const meals = JSON.parse(localStorage.getItem('kfcMeals') || '[]');
                const existingIndex = meals.findIndex(m => m.objectId === mealData.objectId);
                
                if (existingIndex >= 0) {
                    meals[existingIndex] = mealData;
                } else {
                    mealData.objectId = mealData.objectId || 'meal_' + Date.now();
                    mealData.createdAt = mealData.createdAt || new Date().toISOString();
                    meals.push(mealData);
                }
                
                localStorage.setItem('kfcMeals', JSON.stringify(meals));
                this.data.meals = meals;
                
                return mealData;
            },
            
            // åˆ é™¤å¥—é¤ä»LeanCloud
            async deleteMealFromCloud(mealId) {
                if (!this.data.isCloudAvailable) {
                    return this.deleteMealFromLocal(mealId);
                }
                
                try {
                    console.log("ğŸ—‘ï¸ ä»LeanCloudåˆ é™¤å¥—é¤:", mealId);
                    
                    const mealObject = AV.Object.createWithoutData('Meal', mealId);
                    await mealObject.destroy();
                    
                    console.log("âœ… å¥—é¤åˆ é™¤æˆåŠŸ");
                    return true;
                } catch (error) {
                    console.error("âŒ ä»LeanCloudåˆ é™¤å¥—é¤å¤±è´¥:", error);
                    return this.deleteMealFromLocal(mealId);
                }
            },
            
            // åˆ é™¤å¥—é¤ä»æœ¬åœ°å­˜å‚¨
            deleteMealFromLocal(mealId) {
                console.log("ğŸ—‘ï¸ ä»æœ¬åœ°å­˜å‚¨åˆ é™¤å¥—é¤:", mealId);
                
                const meals = JSON.parse(localStorage.getItem('kfcMeals') || '[]');
                const filteredMeals = meals.filter(m => m.objectId !== mealId);
                
                localStorage.setItem('kfcMeals', JSON.stringify(filteredMeals));
                this.data.meals = filteredMeals;
                
                return true;
            },
            
            // ä¿å­˜è®¢å•åˆ°LeanCloud
            async saveOrderToCloud(orderData) {
                if (!this.data.isCloudAvailable) {
                    return this.saveOrderToLocal(orderData);
                }
                
                try {
                    console.log("â˜ï¸ ä¿å­˜è®¢å•åˆ°LeanCloud:", orderData.id);
                    
                    const orderObject = new (AV.Object.extend('Order'))();
                    
                    orderObject.set('orderId', orderData.id);
                    orderObject.set('timestamp', orderData.timestamp);
                    orderObject.set('status', orderData.status);
                    orderObject.set('items', orderData.items);
                    orderObject.set('deliveryInfo', orderData.deliveryInfo);
                    orderObject.set('orderNote', orderData.orderNote || '');
                    orderObject.set('deliveryType', orderData.deliveryType);
                    orderObject.set('totalPrice', orderData.totalPrice);
                    orderObject.set('hasScreenshot', orderData.hasScreenshot || false);
                    orderObject.set('screenshotData', orderData.screenshotData || '');
                    orderObject.set('userId', orderData.userId);
                    orderObject.set('mealName', orderData.mealName);
                    
                    await orderObject.save();
                    orderData.objectId = orderObject.id;
                    orderData.createdAt = orderObject.createdAt;
                    orderData.updatedAt = orderObject.updatedAt;
                    
                    console.log("âœ… è®¢å•ä¿å­˜æˆåŠŸï¼ŒID:", orderObject.id);
                    return orderData;
                } catch (error) {
                    console.error("âŒ ä¿å­˜è®¢å•åˆ°LeanCloudå¤±è´¥:", error);
                    return this.saveOrderToLocal(orderData);
                }
            },
            
            // ä¿å­˜è®¢å•åˆ°æœ¬åœ°å­˜å‚¨
            saveOrderToLocal(orderData) {
                console.log("ğŸ’¾ ä¿å­˜è®¢å•åˆ°æœ¬åœ°å­˜å‚¨:", orderData.id);
                
                const orders = JSON.parse(localStorage.getItem('kfcOrders') || '[]');
                orders.push(orderData);
                
                localStorage.setItem('kfcOrders', JSON.stringify(orders));
                this.data.orders = orders;
                
                // å¦‚æœæ˜¯æ–°è®¢å•ï¼Œå¢åŠ è®¡æ•°
                if (orderData.status === 'new') {
                    this.data.newOrdersCount++;
                    localStorage.setItem('newOrdersCount', this.data.newOrdersCount);
                }
                
                return orderData;
            },
            
            // æ›´æ–°è®¢å•çŠ¶æ€åˆ°LeanCloud - ä¿®å¤ç‰ˆ
            async updateOrderStatusOnCloud(orderId, newStatus) {
                if (!this.data.isCloudAvailable) {
                    console.log("ğŸ“´ LeanCloudä¸å¯ç”¨ï¼Œè·³è¿‡äº‘ç«¯æ›´æ–°");
                    return true; // è¿”å›æˆåŠŸï¼Œè®©æµç¨‹ç»§ç»­
                }
                
                try {
                    console.log("â˜ï¸ æ›´æ–°äº‘ç«¯è®¢å•çŠ¶æ€:", orderId, "->", newStatus);
                    
                    // ä½¿ç”¨LeanCloud APIæ›´æ–°
                    const Order = AV.Object.extend('Order');
                    const orderObject = AV.Object.createWithoutData('Order', orderId);
                    
                    orderObject.set('status', newStatus);
                    await orderObject.save();
                    
                    console.log("âœ… äº‘ç«¯è®¢å•çŠ¶æ€æ›´æ–°æˆåŠŸ");
                    return true;
                } catch (error) {
                    console.error("âŒ æ›´æ–°äº‘ç«¯è®¢å•çŠ¶æ€å¤±è´¥:", error);
                    
                    // æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                    if (error.code === 101) {
                        console.error("è®¢å•ä¸å­˜åœ¨:", orderId);
                    } else if (error.code === 1) {
                        console.error("ç½‘ç»œè¿æ¥é”™è¯¯");
                    } else {
                        console.error("é”™è¯¯ä»£ç :", error.code, "é”™è¯¯ä¿¡æ¯:", error.message);
                    }
                    
                    // æŠ›å‡ºé”™è¯¯è®©ä¸Šå±‚å¤„ç†
                    throw error;
                }
            },
            
            // æ›´æ–°è®¢å•çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨ - ä¿®å¤ç‰ˆï¼ˆå¢å¼ºIDåŒ¹é…é€»è¾‘ï¼‰
            updateOrderStatusOnLocal(orderId, newStatus) {
                console.log("ğŸ’¾ æ›´æ–°æœ¬åœ°è®¢å•çŠ¶æ€:", orderId, "->", newStatus);
                
                const orders = JSON.parse(localStorage.getItem('kfcOrders') || '[]');
                let orderUpdated = false;
                let oldStatus = null;
                
                // å¢å¼ºçš„IDåŒ¹é…é€»è¾‘
                for (let i = 0; i < orders.length; i++) {
                    const order = orders[i];
                    
                    // åŒ¹é…æ‰€æœ‰å¯èƒ½çš„IDå­—æ®µ
                    if (order.objectId === orderId || 
                        order.id === orderId || 
                        order.orderId === orderId ||
                        (order.objectId && order.objectId.toString() === orderId.toString()) ||
                        (order.id && order.id.toString() === orderId.toString())) {
                        
                        oldStatus = order.status;
                        orders[i].status = newStatus;
                        orderUpdated = true;
                        
                        console.log("âœ… æ‰¾åˆ°å¹¶æ›´æ–°æœ¬åœ°è®¢å•:", {
                            id: order.id || order.orderId,
                            æ—§çŠ¶æ€: oldStatus,
                            æ–°çŠ¶æ€: newStatus
                        });
                        break;
                    }
                }
                
                if (orderUpdated) {
                    // æ›´æ–°æœ¬åœ°æ•°æ®å‰¯æœ¬
                    this.data.orders = orders;
                    
                    // æ›´æ–°æ–°è®¢å•è®¡æ•°
                    if (oldStatus === 'new' && newStatus !== 'new') {
                        this.data.newOrdersCount = Math.max(0, this.data.newOrdersCount - 1);
                        localStorage.setItem('newOrdersCount', this.data.newOrdersCount);
                    }
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('kfcOrders', JSON.stringify(orders));
                    return oldStatus;
                }
                
                console.error("âŒ æœ¬åœ°æœªæ‰¾åˆ°è®¢å•:", orderId);
                return null;
            },
            
            // åˆ é™¤è®¢å•ä»LeanCloud
            async deleteOrderFromCloud(orderId) {
                if (!this.data.isCloudAvailable) {
                    return this.deleteOrderFromLocal(orderId);
                }
                
                try {
                    console.log("ğŸ—‘ï¸ ä»LeanCloudåˆ é™¤è®¢å•:", orderId);
                    
                    const orderObject = AV.Object.createWithoutData('Order', orderId);
                    await orderObject.destroy();
                    
                    console.log("âœ… è®¢å•åˆ é™¤æˆåŠŸ");
                    return true;
                } catch (error) {
                    console.error("âŒ ä»LeanCloudåˆ é™¤è®¢å•å¤±è´¥:", error);
                    return this.deleteOrderFromLocal(orderId);
                }
            },
            
            // åˆ é™¤è®¢å•ä»æœ¬åœ°å­˜å‚¨
            deleteOrderFromLocal(orderId) {
                console.log("ğŸ—‘ï¸ ä»æœ¬åœ°å­˜å‚¨åˆ é™¤è®¢å•:", orderId);
                
                const orders = JSON.parse(localStorage.getItem('kfcOrders') || '[]');
                const orderIndex = orders.findIndex(o => o.objectId === orderId || o.id === orderId);
                
                if (orderIndex !== -1) {
                    // å¦‚æœæ˜¯æ–°è®¢å•ï¼Œå‡å°‘è®¡æ•°
                    if (orders[orderIndex].status === 'new') {
                        this.data.newOrdersCount = Math.max(0, this.data.newOrdersCount - 1);
                        localStorage.setItem('newOrdersCount', this.data.newOrdersCount);
                    }
                    
                    orders.splice(orderIndex, 1);
                    localStorage.setItem('kfcOrders', JSON.stringify(orders));
                    this.data.orders = orders;
                    
                    return true;
                }
                
                return false;
            },
            
            // æ¸…ç©ºæ‰€æœ‰è®¢å•ä»LeanCloud
            async clearAllOrdersFromCloud() {
                if (!this.data.isCloudAvailable) {
                    return this.clearAllOrdersFromLocal();
                }
                
                try {
                    console.log("ğŸ—‘ï¸ ä»LeanCloudæ¸…ç©ºæ‰€æœ‰è®¢å•");
                    
                    const Order = AV.Object.extend('Order');
                    const query = new AV.Query('Order');
                    
                    const results = await query.find();
                    const deletePromises = results.map(order => order.destroy());
                    
                    await Promise.all(deletePromises);
                    
                    console.log("âœ… æ‰€æœ‰è®¢å•å·²æ¸…ç©º");
                    return true;
                } catch (error) {
                    console.error("âŒ æ¸…ç©ºæ‰€æœ‰è®¢å•å¤±è´¥:", error);
                    return this.clearAllOrdersFromLocal();
                }
            },
            
            // æ¸…ç©ºæ‰€æœ‰è®¢å•ä»æœ¬åœ°å­˜å‚¨
            clearAllOrdersFromLocal() {
                console.log("ğŸ—‘ï¸ ä»æœ¬åœ°å­˜å‚¨æ¸…ç©ºæ‰€æœ‰è®¢å•");
                
                localStorage.setItem('kfcOrders', JSON.stringify([]));
                this.data.orders = [];
                this.data.newOrdersCount = 0;
                localStorage.setItem('newOrdersCount', 0);
                
                return true;
            },
            
            // æ˜¾ç¤ºé¡µé¢
            showPage(pageId) {
                // éšè—æ‰€æœ‰é¡µé¢
                document.querySelectorAll('.meal-page-container').forEach(page => {
                    page.classList.remove('active');
                });
                
                // æ˜¾ç¤ºç›®æ ‡é¡µé¢
                document.getElementById(pageId).classList.add('active');
                
                // æ›´æ–°å¤´éƒ¨æŒ‰é’®æ˜¾ç¤º
                if (pageId === 'homePage') {
                    document.getElementById('viewOrdersBtn').style.display = 'flex';
                    document.getElementById('viewHomeBtn').style.display = 'none';
                } else {
                    document.getElementById('viewOrdersBtn').style.display = 'none';
                    document.getElementById('viewHomeBtn').style.display = 'flex';
                }
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo(0, 0);
            },
            
            // æ›´æ–°é¦–é¡µ
            updateHomePage() {
                const mealGrid = document.getElementById('mealGrid');
                const noMealsMessage = document.getElementById('noMealsMessage');
                const loadingMeals = document.getElementById('loadingMeals');
                
                if (loadingMeals) {
                    loadingMeals.style.display = 'none';
                }
                
                mealGrid.innerHTML = '';
                
                const activeMeals = this.data.meals.filter(meal => meal.active !== false);
                
                if (activeMeals.length === 0) {
                    noMealsMessage.style.display = 'block';
                    return;
                }
                
                noMealsMessage.style.display = 'none';
                
                activeMeals.forEach(meal => {
                    const mealCard = document.createElement('a');
                    mealCard.href = '#';
                    mealCard.className = 'meal-card';
                    
                    if (meal.active === false) {
                        mealCard.classList.add('inactive');
                    }
                    
                    mealCard.onclick = (e) => {
                        e.preventDefault();
                        if (meal.active === false) return;
                        this.showMealDetail(meal.objectId || meal.id);
                    };
                    
                    mealCard.innerHTML = `
                        <div class="meal-header">
                            <h4 class="meal-name">${meal.name}</h4>
                            <div class="meal-price">Â¥${meal.price}</div>
                        </div>
                        <div class="meal-description">
                            ${Array.isArray(meal.tags) ? meal.tags.map(tag => `<span class="meal-tag">${tag}</span>`).join('') : ''}
                            <p style="margin-top: 10px;">${meal.description}</p>
                        </div>
                    `;
                    
                    mealGrid.appendChild(mealCard);
                });
            },
            
            // æ˜¾ç¤ºå¥—é¤è¯¦æƒ…
            showMealDetail(mealId) {
                const meal = this.data.meals.find(m => (m.objectId === mealId) || (m.id === mealId));
                if (!meal) {
                    this.showNotification('å¥—é¤ä¸å­˜åœ¨ï¼', 'error');
                    return;
                }
                
                this.data.currentMeal = meal;
                this.data.selectedOptions = {};
                this.data.currentCart = [];
                
                // åˆå§‹åŒ–é€‰æ‹©é€‰é¡¹
                if (meal.optionGroups && meal.optionGroups.length > 0) {
                    meal.optionGroups.forEach(group => {
                        this.data.selectedOptions[group.title] = {};
                        group.items.forEach(item => {
                            this.data.selectedOptions[group.title][item.name] = 0;
                        });
                    });
                }
                
                const mealDetailPage = document.getElementById('mealDetailPage');
                
                mealDetailPage.innerHTML = `
                    <button class="back-btn" onclick="KFCSystem.showPage('homePage')">
                        <i class="fas fa-arrow-left"></i>
                        è¿”å›å¥—é¤åˆ—è¡¨
                    </button>
                    
                    <div class="main-content">
                        <div class="menu-section">
                            <h2 class="section-title">
                                <i class="fas fa-hamburger"></i>
                                ${meal.name}
                            </h2>
                            
                            <div class="instructions">
                                <p><strong>å¥—é¤è¯¦æƒ…ï¼š</strong></p>
                                <ul>
                                    <li>${meal.description}</li>
                                    <li>è¯·æŒ‰ç…§è¦æ±‚é€‰æ‹©é€‰é¡¹</li>
                                    <li>æäº¤è®¢å•åå¯åœ¨å³ä¸Šè§’"æŸ¥çœ‹æˆ‘çš„è®¢å•"æŸ¥çœ‹è®¢å•çŠ¶æ€</li>
                                </ul>
                            </div>
                            
                            <div class="meal-options" id="mealOptions">
                                ${this.generateOptionsHTML(meal)}
                            </div>
                            
                            <button class="add-to-cart" id="addToCartBtn" data-meal-id="${meal.objectId || meal.id}" data-meal-name="${meal.name}" data-meal-price="${meal.price}" disabled>
                                <i class="fas fa-cart-plus"></i>
                                åŠ å…¥è´­ç‰©è½¦
                            </button>
                        </div>
                        
                        <div class="cart-section">
                            <h2 class="section-title">
                                <i class="fas fa-shopping-cart"></i>
                                è´­ç‰©è½¦
                            </h2>
                            
                            <div class="cart-items" id="cartItems">
                                <div class="empty-cart-message">è´­ç‰©è½¦æ˜¯ç©ºçš„ï¼Œè¯·é€‰æ‹©å¥—é¤</div>
                            </div>
                            
                            <div class="cart-total">
                                <span>æ€»è®¡ï¼š</span>
                                <span class="total-price" id="totalPrice">Â¥0.00</span>
                            </div>
                            
                            <button class="checkout-btn" id="checkoutBtn" disabled>
                                <i class="fas fa-credit-card"></i>
                                æäº¤è®¢å•
                            </button>
                            
                            <div class="delivery-form">
                                <h3 class="section-title" style="font-size: 1.4rem;">
                                    <i class="fas fa-truck"></i>
                                    é…é€ä¿¡æ¯
                                </h3>
                                
                                <div class="order-type">
                                    <label>
                                        <input type="radio" name="deliveryType" value="delivery" checked>
                                        <span>å®…æ€¥é€ï¼ˆå…é…é€è´¹ï¼‰</span>
                                    </label>
                                    <label>
                                        <input type="radio" name="deliveryType" value="pickup">
                                        <span>åˆ°åº—è‡ªæ</span>
                                    </label>
                                </div>
                                
                                <div class="delivery-fields" id="deliveryFields">
                                    <div class="form-group">
                                        <label class="form-label">æ”¶è´§äººå§“å <span class="required">*</span></label>
                                        <input type="text" class="form-input" id="customerName" placeholder="è¯·è¾“å…¥å§“å" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">è”ç³»ç”µè¯ <span class="required">*</span></label>
                                        <input type="tel" class="form-input" id="customerPhone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç " required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">é…é€åœ°å€ <span class="required">*</span></label>
                                        <input type="text" class="form-input" id="deliveryAddress" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€" required>
                                    </div>
                                </div>
                                
                                <div class="pickup-fields hidden" id="pickupFields">
                                    <div class="form-group">
                                        <label class="form-label">é—¨åº—ä¿¡æ¯æä¾›æ–¹å¼ <span class="required">*</span></label>
                                        <div class="info-method-selector">
                                            <label class="method-option">
                                                <input type="radio" name="pickupMethod" value="text" checked>
                                                <span>æ‰‹åŠ¨å¡«å†™</span>
                                            </label>
                                            <label class="method-option">
                                                <input type="radio" name="pickupMethod" value="screenshot">
                                                <span>ä¸Šä¼ æˆªå›¾</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="text-method-fields" id="textMethodFields">
                                        <div class="store-selection">
                                            <div class="form-group">
                                                <label class="form-label">è‡ªæåŸå¸‚ <span class="required">*</span></label>
                                                <input type="text" class="form-input" id="pickupCityInput" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å¸‚" required>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label class="form-label">è‡ªæé—¨åº— <span class="required">*</span></label>
                                                <input type="text" class="form-input" id="pickupStoreInput" placeholder="ä¾‹å¦‚ï¼šè‚¯å¾·åŸºç‹åºœäº•åº—" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="screenshot-method-fields hidden" id="screenshotMethodFields">
                                        <div class="form-group">
                                            <label class="form-label">ä¸Šä¼ é—¨åº—æˆªå›¾ <span class="required">*</span></label>
                                            <div class="screenshot-upload-area" id="screenshotUploadArea">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <p>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æˆªå›¾</p>
                                                <p class="upload-hint">æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡ 5MB</p>
                                                <input type="file" id="storeScreenshot" accept="image/*" style="display: none;">
                                            </div>
                                            <div class="screenshot-preview hidden" id="screenshotPreview">
                                                <img id="previewImage" src="" alt="æˆªå›¾é¢„è§ˆ">
                                                <button type="button" class="remove-screenshot" id="removeScreenshot">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">è®¢å•å¤‡æ³¨</label>
                                    <textarea class="form-input" id="orderNote" rows="3" placeholder="å¦‚æœ‰ç‰¹æ®Šè¦æ±‚è¯·åœ¨æ­¤å¤‡æ³¨ï¼ˆä¾‹å¦‚ï¼šä¸åƒè¾£ï¼Œå¤šè¦ç•ªèŒ„é…±ç­‰ï¼‰"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.initOptionSelection();
                this.initDeliveryTypeToggle();
                this.initPickupMethod();
                this.initScreenshotUpload();
                this.updateAddToCartButton();
                
                this.showPage('mealDetailPage');
            },
            
            // ç”Ÿæˆé€‰é¡¹HTML
            generateOptionsHTML(meal) {
                let html = '';
                
                if (meal.optionGroups && meal.optionGroups.length > 0) {
                    meal.optionGroups.forEach((group, groupIndex) => {
                        const groupId = `group-${meal.objectId || meal.id}-${groupIndex}`;
                        const repeat = group.repeat ? 'true' : 'false';
                        const maxPerItem = group.maxPerItem || (group.repeat ? 999 : 1);
                        
                        html += `
                            <div class="option-group" data-group-id="${groupId}" data-min-select="${group.minSelect}" data-max-select="${group.maxSelect}" data-repeat="${repeat}" data-max-per-item="${maxPerItem}">
                                <div class="option-title">${group.title}</div>
                                <div class="option-rules">${group.rules}</div>
                                <div class="option-items">
                        `;
                        
                        if (group.items && group.items.length > 0) {
                            group.items.forEach((item, itemIndex) => {
                                const itemId = `${groupId}-${itemIndex}`;
                                const addPrice = item.addPrice || 0;
                                const addPriceText = addPrice > 0 ? ` (+Â¥${addPrice})` : '';
                                
                                html += `
                                    <div class="option-item" data-item-id="${itemId}" data-name="${item.name}" data-add-price="${addPrice}">
                                        <span>${item.name}${addPriceText}</span>
                                        <div class="selection-counter">
                                            <button class="counter-btn decrement" disabled>-</button>
                                            <span class="counter-value">0</span>
                                            <button class="counter-btn increment">+</button>
                                        </div>
                                    </div>
                                `;
                            });
                        }
                        
                        html += `
                                </div>
                                <div class="selection-status invalid">å·²é€‰æ‹© 0 ä»½ï¼Œè¿˜éœ€é€‰æ‹© ${group.minSelect} ä»½</div>
                            </div>
                        `;
                    });
                }
                
                if (meal.fixedItems && meal.fixedItems.length > 0) {
                    html += `
                        <div class="fixed-combo-items">
                            <div class="option-title">å›ºå®šæ­é…ï¼š</div>
                            <div class="option-rules">å¥—é¤åŒ…å«å›ºå®šæ­é…ï¼Œæ— éœ€é€‰æ‹©</div>
                            <div class="fixed-combo-list">
                    `;
                    
                    meal.fixedItems.forEach(item => {
                        html += `
                            <div class="fixed-combo-item">
                                <div class="fixed-combo-item-name">${item.name}</div>
                                <div class="fixed-combo-item-qty">Ã—${item.quantity}</div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                return html;
            },
            
            // åˆå§‹åŒ–é€‰é¡¹é€‰æ‹©
            initOptionSelection() {
                const optionItems = document.querySelectorAll('.option-item');
                
                optionItems.forEach(item => {
                    const itemName = item.dataset.name;
                    const groupElement = item.closest('.option-group');
                    const groupTitle = groupElement.querySelector('.option-title').textContent;
                    
                    // ç‚¹å‡»é€‰é¡¹
                    item.addEventListener('click', () => {
                        this.toggleOptionSelection(item, groupTitle, itemName);
                    });
                    
                    // å¢åŠ æŒ‰é’®
                    const incrementBtn = item.querySelector('.increment');
                    incrementBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.incrementOption(item, groupTitle, itemName);
                    });
                    
                    // å‡å°‘æŒ‰é’®
                    const decrementBtn = item.querySelector('.decrement');
                    decrementBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.decrementOption(item, groupTitle, itemName);
                    });
                });
            },
            
            // åˆ‡æ¢é€‰é¡¹é€‰æ‹©
            toggleOptionSelection(item, groupTitle, itemName) {
                const groupElement = item.closest('.option-group');
                const repeat = groupElement.dataset.repeat === 'true';
                const maxPerItem = parseInt(groupElement.dataset.maxPerItem) || 1;
                const currentCount = this.data.selectedOptions[groupTitle][itemName] || 0;
                
                if (!repeat) {
                    // éé‡å¤é€‰æ‹©ï¼šåˆ‡æ¢é€‰æ‹©çŠ¶æ€
                    const isSelected = item.classList.contains('selected');
                    
                    // å…ˆå–æ¶ˆåŒä¸€ç»„ä¸­å…¶ä»–é€‰é¡¹çš„é€‰æ‹©
                    groupElement.querySelectorAll('.option-item').forEach(otherItem => {
                        otherItem.classList.remove('selected');
                        otherItem.querySelector('.counter-value').textContent = '0';
                        otherItem.querySelector('.decrement').disabled = true;
                        
                        const otherName = otherItem.dataset.name;
                        if (otherName !== itemName) {
                            this.data.selectedOptions[groupTitle][otherName] = 0;
                        }
                    });
                    
                    if (!isSelected) {
                        item.classList.add('selected');
                        item.querySelector('.counter-value').textContent = '1';
                        item.querySelector('.decrement').disabled = false;
                        this.data.selectedOptions[groupTitle][itemName] = 1;
                    } else {
                        this.data.selectedOptions[groupTitle][itemName] = 0;
                    }
                } else {
                    // é‡å¤é€‰æ‹©ï¼šå¢åŠ æ•°é‡ï¼ˆç›´åˆ°è¾¾åˆ°ä¸Šé™ï¼‰
                    if (currentCount < maxPerItem) {
                        this.data.selectedOptions[groupTitle][itemName] = currentCount + 1;
                        item.querySelector('.counter-value').textContent = currentCount + 1;
                        
                        if (currentCount + 1 > 0) {
                            item.classList.add('selected');
                            item.querySelector('.decrement').disabled = false;
                        }
                        
                        // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ä¸Šé™
                        if (currentCount + 1 >= maxPerItem) {
                            item.querySelector('.increment').disabled = true;
                        }
                    }
                }
                
                this.updateGroupSelectionStatus(groupElement, groupTitle);
                this.updateAddToCartButton();
                this.updateCartDisplay();
            },
            
            // å¢åŠ é€‰é¡¹æ•°é‡
            incrementOption(item, groupTitle, itemName) {
                const groupElement = item.closest('.option-group');
                const maxPerItem = parseInt(groupElement.dataset.maxPerItem) || 999;
                const currentCount = this.data.selectedOptions[groupTitle][itemName] || 0;
                
                if (currentCount < maxPerItem) {
                    this.data.selectedOptions[groupTitle][itemName] = currentCount + 1;
                    item.querySelector('.counter-value').textContent = currentCount + 1;
                    
                    if (currentCount + 1 > 0) {
                        item.classList.add('selected');
                        item.querySelector('.decrement').disabled = false;
                    }
                    
                    if (currentCount + 1 >= maxPerItem) {
                        item.querySelector('.increment').disabled = true;
                    }
                    
                    this.updateGroupSelectionStatus(groupElement, groupTitle);
                    this.updateAddToCartButton();
                    this.updateCartDisplay();
                }
            },
            
            // å‡å°‘é€‰é¡¹æ•°é‡
            decrementOption(item, groupTitle, itemName) {
                const groupElement = item.closest('.option-group');
                const currentCount = this.data.selectedOptions[groupTitle][itemName] || 0;
                
                if (currentCount > 0) {
                    this.data.selectedOptions[groupTitle][itemName] = currentCount - 1;
                    item.querySelector('.counter-value').textContent = currentCount - 1;
                    
                    if (currentCount - 1 === 0) {
                        item.classList.remove('selected');
                        item.querySelector('.decrement').disabled = true;
                    }
                    
                    item.querySelector('.increment').disabled = false;
                    
                    this.updateGroupSelectionStatus(groupElement, groupTitle);
                    this.updateAddToCartButton();
                    this.updateCartDisplay();
                }
            },
            
            // æ›´æ–°é€‰é¡¹ç»„é€‰æ‹©çŠ¶æ€
            updateGroupSelectionStatus(groupElement, groupTitle) {
                const minSelect = parseInt(groupElement.dataset.minSelect);
                const maxSelect = parseInt(groupElement.dataset.maxSelect);
                const statusElement = groupElement.querySelector('.selection-status');
                
                const selectedCount = Object.values(this.data.selectedOptions[groupTitle] || {}).reduce((sum, count) => sum + count, 0);
                
                if (selectedCount >= minSelect && selectedCount <= maxSelect) {
                    statusElement.textContent = `å·²é€‰æ‹© ${selectedCount} ä»½ï¼Œé€‰æ‹©å®Œæˆ`;
                    statusElement.className = 'selection-status valid';
                } else if (selectedCount < minSelect) {
                    statusElement.textContent = `å·²é€‰æ‹© ${selectedCount} ä»½ï¼Œè¿˜éœ€é€‰æ‹© ${minSelect - selectedCount} ä»½`;
                    statusElement.className = 'selection-status invalid';
                } else {
                    statusElement.textContent = `å·²é€‰æ‹© ${selectedCount} ä»½ï¼Œå·²è¶…è¿‡æœ€å¤§é€‰æ‹©æ•°é‡`;
                    statusElement.className = 'selection-status invalid';
                }
            },
            
            // æ›´æ–°åŠ å…¥è´­ç‰©è½¦æŒ‰é’®çŠ¶æ€
            updateAddToCartButton() {
                const addToCartBtn = document.getElementById('addToCartBtn');
                if (!addToCartBtn) return;
                
                const meal = this.data.currentMeal;
                if (!meal.optionGroups || meal.optionGroups.length === 0) {
                    addToCartBtn.disabled = false;
                    addToCartBtn.addEventListener('click', () => {
                        this.addToCart();
                    });
                    return;
                }
                
                let allValid = true;
                const groupElements = document.querySelectorAll('.option-group');
                
                groupElements.forEach(groupElement => {
                    const minSelect = parseInt(groupElement.dataset.minSelect);
                    const maxSelect = parseInt(groupElement.dataset.maxSelect);
                    const groupTitle = groupElement.querySelector('.option-title').textContent;
                    const selectedCount = Object.values(this.data.selectedOptions[groupTitle] || {}).reduce((sum, count) => sum + count, 0);
                    
                    if (selectedCount < minSelect || selectedCount > maxSelect) {
                        allValid = false;
                    }
                });
                
                addToCartBtn.disabled = !allValid;
                
                if (!allValid) {
                    addToCartBtn.style.opacity = '0.6';
                    addToCartBtn.style.cursor = 'not-allowed';
                    addToCartBtn.onclick = null;
                } else {
                    addToCartBtn.style.opacity = '1';
                    addToCartBtn.style.cursor = 'pointer';
                    addToCartBtn.onclick = () => {
                        this.addToCart();
                    };
                }
            },
            
            // åˆå§‹åŒ–é…é€ç±»å‹åˆ‡æ¢
            initDeliveryTypeToggle() {
                const deliveryRadios = document.querySelectorAll('input[name="deliveryType"]');
                const deliveryFields = document.getElementById('deliveryFields');
                const pickupFields = document.getElementById('pickupFields');
                
                deliveryRadios.forEach(radio => {
                    radio.addEventListener('change', () => {
                        if (radio.value === 'delivery') {
                            deliveryFields.classList.remove('hidden');
                            pickupFields.classList.add('hidden');
                        } else {
                            deliveryFields.classList.add('hidden');
                            pickupFields.classList.remove('hidden');
                        }
                    });
                });
            },
            
            // åˆå§‹åŒ–è‡ªææ–¹å¼
            initPickupMethod() {
                const pickupRadios = document.querySelectorAll('input[name="pickupMethod"]');
                const textFields = document.getElementById('textMethodFields');
                const screenshotFields = document.getElementById('screenshotMethodFields');
                
                if (pickupRadios.length > 0) {
                    pickupRadios.forEach(radio => {
                        radio.addEventListener('change', () => {
                            if (radio.value === 'text') {
                                textFields.classList.remove('hidden');
                                screenshotFields.classList.add('hidden');
                            } else {
                                textFields.classList.add('hidden');
                                screenshotFields.classList.remove('hidden');
                            }
                        });
                    });
                }
            },
            
            // åˆå§‹åŒ–æˆªå›¾ä¸Šä¼ 
            initScreenshotUpload() {
                const uploadArea = document.getElementById('screenshotUploadArea');
                const fileInput = document.getElementById('storeScreenshot');
                const preview = document.getElementById('screenshotPreview');
                const previewImage = document.getElementById('previewImage');
                const removeBtn = document.getElementById('removeScreenshot');
                
                if (!uploadArea || !fileInput) return;
                
                // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
                uploadArea.addEventListener('click', () => {
                    fileInput.click();
                });
                
                // æ‹–æ‹½ä¸Šä¼ 
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#e31837';
                    uploadArea.style.backgroundColor = '#fff5f5';
                });
                
                uploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#ddd';
                    uploadArea.style.backgroundColor = '#f9f9f9';
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#ddd';
                    uploadArea.style.backgroundColor = '#f9f9f9';
                    
                    const file = e.dataTransfer.files[0];
                    if (file && file.type.startsWith('image/')) {
                        this.handleScreenshotUpload(file);
                    } else {
                        this.showNotification('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼', 'error');
                    }
                });
                
                // æ–‡ä»¶é€‰æ‹©å˜åŒ–
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.handleScreenshotUpload(file);
                    }
                });
                
                // ç§»é™¤æˆªå›¾
                if (removeBtn) {
                    removeBtn.addEventListener('click', () => {
                        preview.classList.add('hidden');
                        fileInput.value = '';
                    });
                }
            },
            
            // å¤„ç†æˆªå›¾ä¸Šä¼ 
            handleScreenshotUpload(file) {
                if (!file.type.startsWith('image/')) {
                    this.showNotification('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼', 'error');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    this.showNotification('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MBï¼', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('screenshotPreview');
                    const previewImage = document.getElementById('previewImage');
                    
                    previewImage.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            },
            
            // æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º
            updateCartDisplay() {
                const cartItems = document.getElementById('cartItems');
                const totalPrice = document.getElementById('totalPrice');
                const checkoutBtn = document.getElementById('checkoutBtn');
                
                if (!cartItems) return;
                
                // è®¡ç®—æ€»ä»·å’Œé¡¹ç›®
                this.data.currentCart = [];
                let total = 0;
                
                // æ·»åŠ ä¸»å¥—é¤
                const meal = this.data.currentMeal;
                if (meal) {
                    this.data.currentCart.push({
                        name: meal.name,
                        price: meal.price,
                        quantity: 1,
                        type: 'å¥—é¤'
                    });
                    total += meal.price;
                    
                    // æ·»åŠ é€‰æ‹©çš„é€‰é¡¹
                    if (meal.optionGroups && meal.optionGroups.length > 0) {
                        meal.optionGroups.forEach(group => {
                            Object.entries(this.data.selectedOptions[group.title] || {}).forEach(([itemName, quantity]) => {
                                if (quantity > 0) {
                                    const itemData = group.items.find(item => item.name === itemName);
                                    if (itemData) {
                                        const itemPrice = (itemData.addPrice || 0) * quantity;
                                        total += itemPrice;
                                        this.data.currentCart.push({
                                            name: `${itemName} (${group.title})`,
                                            price: itemPrice,
                                            quantity: quantity,
                                            type: 'é€‰é¡¹'
                                        });
                                    }
                                }
                            });
                        });
                    }
                    
                    // æ·»åŠ å›ºå®šæ­é…
                    if (meal.fixedItems && meal.fixedItems.length > 0) {
                        meal.fixedItems.forEach(item => {
                            this.data.currentCart.push({
                                name: item.name,
                                price: 0,
                                quantity: item.quantity,
                                type: 'å›ºå®šæ­é…'
                            });
                        });
                    }
                }
                
                // æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º
                cartItems.innerHTML = '';
                if (this.data.currentCart.length === 0) {
                    cartItems.innerHTML = '<div class="empty-cart-message">è´­ç‰©è½¦æ˜¯ç©ºçš„ï¼Œè¯·é€‰æ‹©å¥—é¤</div>';
                    checkoutBtn.disabled = true;
                    totalPrice.textContent = 'Â¥0.00';
                    return;
                }
                
                this.data.currentCart.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'cart-item';
                    itemElement.innerHTML = `
                        <div class="cart-item-name">${item.name} Ã—${item.quantity}</div>
                        <div class="cart-item-price">${item.price > 0 ? 'Â¥' + item.price.toFixed(2) : 'å·²åŒ…å«'}</div>
                        ${item.type !== 'å›ºå®šæ­é…' ? `<button class="cart-item-remove" data-index="${index}"><i class="fas fa-times"></i></button>` : ''}
                    `;
                    
                    cartItems.appendChild(itemElement);
                });
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                cartItems.querySelectorAll('.cart-item-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.target.closest('.cart-item-remove').dataset.index);
                        this.removeCartItem(index);
                    });
                });
                
                // æ›´æ–°æ€»ä»·
                totalPrice.textContent = `Â¥${total.toFixed(2)}`;
                
                // å¯ç”¨ç»“ç®—æŒ‰é’®
                checkoutBtn.disabled = false;
                checkoutBtn.onclick = () => {
                    this.submitOrder(total);
                };
            },
            
            // åŠ å…¥è´­ç‰©è½¦
            addToCart() {
                this.updateCartDisplay();
                this.showNotification('å·²åŠ å…¥è´­ç‰©è½¦ï¼', 'success');
            },
            
            // ç§»é™¤è´­ç‰©è½¦é¡¹ç›®
            removeCartItem(index) {
                if (index >= 0 && index < this.data.currentCart.length) {
                    const item = this.data.currentCart[index];
                    
                    // å¦‚æœæ˜¯é€‰é¡¹ï¼Œéœ€è¦å‡å°‘å¯¹åº”çš„é€‰æ‹©æ•°é‡
                    if (item.type === 'é€‰é¡¹') {
                        const meal = this.data.currentMeal;
                        if (meal && meal.optionGroups) {
                            for (const group of meal.optionGroups) {
                                for (const itemData of group.items) {
                                    if (item.name.includes(itemData.name)) {
                                        const groupTitle = group.title;
                                        this.data.selectedOptions[groupTitle][itemData.name] = 0;
                                        
                                        // æ›´æ–°é€‰é¡¹æ˜¾ç¤º
                                        const optionItems = document.querySelectorAll('.option-item');
                                        optionItems.forEach(optionItem => {
                                            if (optionItem.dataset.name === itemData.name) {
                                                optionItem.classList.remove('selected');
                                                optionItem.querySelector('.counter-value').textContent = '0';
                                                optionItem.querySelector('.decrement').disabled = true;
                                                optionItem.querySelector('.increment').disabled = false;
                                            }
                                        });
                                        
                                        // æ›´æ–°é€‰é¡¹ç»„çŠ¶æ€
                                        const groupElement = optionItems[0]?.closest('.option-group');
                                        if (groupElement) {
                                            this.updateGroupSelectionStatus(groupElement, groupTitle);
                                        }
                                        break;
                                    }
                                }
                            }
                        }
                    }
                    
                    // ä»è´­ç‰©è½¦ç§»é™¤
                    this.data.currentCart.splice(index, 1);
                    this.updateCartDisplay();
                    this.updateAddToCartButton();
                }
            },
            
            // æäº¤è®¢å•
            async submitOrder(totalPrice) {
                // éªŒè¯è¡¨å•
                const deliveryType = document.querySelector('input[name="deliveryType"]:checked').value;
                let isValid = true;
                let deliveryInfo = {};
                
                if (deliveryType === 'delivery') {
                    const customerName = document.getElementById('customerName').value.trim();
                    const customerPhone = document.getElementById('customerPhone').value.trim();
                    const deliveryAddress = document.getElementById('deliveryAddress').value.trim();
                    
                    if (!customerName || !customerPhone || !deliveryAddress) {
                        this.showNotification('è¯·å¡«å†™å®Œæ•´çš„é…é€ä¿¡æ¯ï¼', 'error');
                        isValid = false;
                    } else {
                        deliveryInfo = {
                            name: customerName,
                            phone: customerPhone,
                            address: deliveryAddress
                        };
                    }
                } else {
                    const pickupMethod = document.querySelector('input[name="pickupMethod"]:checked')?.value || 'text';
                    
                    if (pickupMethod === 'text') {
                        const pickupCity = document.getElementById('pickupCityInput').value.trim();
                        const pickupStore = document.getElementById('pickupStoreInput').value.trim();
                        
                        if (!pickupCity || !pickupStore) {
                            this.showNotification('è¯·å¡«å†™å®Œæ•´çš„è‡ªæä¿¡æ¯ï¼', 'error');
                            isValid = false;
                        } else {
                            deliveryInfo = {
                                method: 'text',
                                city: pickupCity,
                                store: pickupStore
                            };
                        }
                    } else {
                        // æˆªå›¾æ–¹å¼
                        const previewImage = document.getElementById('previewImage');
                        if (!previewImage || !previewImage.src || previewImage.src === '') {
                            this.showNotification('è¯·ä¸Šä¼ é—¨åº—æˆªå›¾ï¼', 'error');
                            isValid = false;
                        } else {
                            deliveryInfo = {
                                method: 'screenshot',
                                screenshot: previewImage.src
                            };
                        }
                    }
                }
                
                if (!isValid) return;
                
                // åˆ›å»ºè®¢å•
                const orderId = 'ORD' + Date.now() + Math.random().toString(36).substr(2, 6).toUpperCase();
                const orderNote = document.getElementById('orderNote').value.trim();
                
                const order = {
                    id: orderId,
                    timestamp: new Date().toLocaleString('zh-CN'),
                    status: 'new',
                    userId: this.data.currentUser.id,
                    mealName: this.data.currentMeal.name,
                    items: [...this.data.currentCart],
                    totalPrice: totalPrice,
                    deliveryType: deliveryType,
                    deliveryInfo: deliveryInfo,
                    orderNote: orderNote,
                    hasScreenshot: deliveryInfo.method === 'screenshot',
                    screenshotData: deliveryInfo.method === 'screenshot' ? deliveryInfo.screenshot : '',
                    createdAt: new Date().toISOString()
                };
                
                try {
                    // ä¿å­˜è®¢å•åˆ°äº‘ç«¯
                    const savedOrder = await this.saveOrderToCloud(order);
                    
                    // æ·»åŠ åˆ°æœ¬åœ°æ•°æ®
                    this.data.orders.push(savedOrder);
                    this.data.newOrdersCount++;
                    
                    // æ›´æ–°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('kfcOrders', JSON.stringify(this.data.orders));
                    localStorage.setItem('newOrdersCount', this.data.newOrdersCount);
                    
                    // æ›´æ–°æ–°è®¢å•å¾½ç« 
                    this.updateOrderBadge();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    this.showNotification(`è®¢å•æäº¤æˆåŠŸï¼\nè®¢å•å·ï¼š${orderId}\næ€»é‡‘é¢ï¼šÂ¥${totalPrice.toFixed(2)}`, 'success');
                    
                    // é‡ç½®æ•°æ®
                    this.data.currentCart = [];
                    this.data.selectedOptions = {};
                    this.data.currentMeal = null;
                    
                    // è¿”å›é¦–é¡µ
                    this.showPage('homePage');
                    
                } catch (error) {
                    console.error("âŒ ä¿å­˜è®¢å•å¤±è´¥:", error);
                    this.showNotification('æäº¤è®¢å•å¤±è´¥ï¼Œè¯·é‡è¯•ï¼', 'error');
                }
            },
            
            // æ˜¾ç¤ºæˆ‘çš„è®¢å•é¡µé¢
            showMyOrdersPage() {
                this.showPage('myOrdersPage');
                this.renderUserOrders('all');
            },
            
            // æ¸²æŸ“ç”¨æˆ·è®¢å•
            renderUserOrders(filter = 'all') {
                const container = document.getElementById('myOrdersContainer');
                const noOrdersMsg = document.getElementById('noUserOrdersMessage');
                const loadingOrders = document.getElementById('loadingOrders');
                
                if (loadingOrders) {
                    loadingOrders.style.display = 'none';
                }
                
                // è·å–å½“å‰ç”¨æˆ·çš„è®¢å•
                let userOrders = this.data.orders.filter(order => order.userId === this.data.currentUser.id);
                
                if (filter !== 'all') {
                    userOrders = userOrders.filter(order => order.status === filter);
                }
                
                if (userOrders.length === 0) {
                    container.innerHTML = '';
                    noOrdersMsg.style.display = 'block';
                    return;
                }
                
                noOrdersMsg.style.display = 'none';
                container.innerHTML = '';
                
                userOrders.forEach(order => {
                    const orderElement = this.createUserOrderElement(order);
                    container.appendChild(orderElement);
                });
            },
            
            // åˆ›å»ºç”¨æˆ·è®¢å•å…ƒç´  - ä¿®å¤ç‰ˆï¼ˆæ·»åŠ æˆªå›¾æŸ¥çœ‹ï¼‰
            createUserOrderElement(order) {
                const orderElement = document.createElement('div');
                orderElement.className = 'user-order-item';
                
                let statusClass, statusText;
                switch (order.status) {
                    case 'new':
                        statusClass = 'user-status-new';
                        statusText = 'æ–°è®¢å•';
                        break;
                    case 'processing':
                        statusClass = 'user-status-processing';
                        statusText = 'å¤„ç†ä¸­';
                        break;
                    case 'completed':
                        statusClass = 'user-status-completed';
                        statusText = 'å·²å®Œæˆ';
                        break;
                    default:
                        statusClass = 'user-status-new';
                        statusText = 'æ–°è®¢å•';
                }
                
                let deliveryText = '';
                let screenshotHtml = '';
                
                if (order.deliveryType === 'delivery') {
                    deliveryText = `å®…æ€¥é€ - ${order.deliveryInfo.name} - ${order.deliveryInfo.phone} - ${order.deliveryInfo.address}`;
                } else {
                    if (order.deliveryInfo.method === 'text') {
                        deliveryText = `åˆ°åº—è‡ªæ - ${order.deliveryInfo.city} - ${order.deliveryInfo.store}`;
                    } else {
                        deliveryText = `åˆ°åº—è‡ªæ - æˆªå›¾æ–¹å¼`;
                        
                        // æ·»åŠ æˆªå›¾æ˜¾ç¤ºï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                        if (order.screenshotData || order.hasScreenshot) {
                            const screenshotData = order.screenshotData || '';
                            screenshotHtml = `
                                <div style="margin-top: 10px;">
                                    <button class="view-screenshot-btn" onclick="KFCSystem.showScreenshot('${this.escapeHtml(screenshotData)}')">
                                        <i class="fas fa-image"></i>
                                        æŸ¥çœ‹é—¨åº—æˆªå›¾
                                    </button>
                                </div>
                            `;
                        }
                    }
                }
                
                orderElement.innerHTML = `
                    <div class="user-order-header">
                        <div>
                            <div class="user-order-id">è®¢å•å·ï¼š${order.id}</div>
                            <div class="user-order-time">${order.timestamp}</div>
                        </div>
                        <div class="user-order-status ${statusClass}">${statusText}</div>
                    </div>
                    
                    <div class="user-order-items">
                        ${order.items.map(item => `
                            <div class="user-order-item-detail">
                                <div class="user-order-item-name">${item.name} Ã—${item.quantity}</div>
                                <div class="user-order-item-price">${item.price > 0 ? 'Â¥' + item.price.toFixed(2) : 'å·²åŒ…å«'}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="user-order-info">
                        <p><strong>é…é€æ–¹å¼ï¼š</strong>${deliveryText}</p>
                        ${screenshotHtml}
                        ${order.orderNote ? `<p><strong>å¤‡æ³¨ï¼š</strong>${order.orderNote}</p>` : ''}
                    </div>
                    
                    <div class="user-order-total">
                        æ€»è®¡ï¼šÂ¥${order.totalPrice.toFixed(2)}
                    </div>
                `;
                
                return orderElement;
            },
            
            // æœç´¢ç”¨æˆ·è®¢å•
            searchUserOrders() {
                const searchTerm = document.getElementById('orderSearchInput').value.trim().toLowerCase();
                if (!searchTerm) {
                    this.renderUserOrders('all');
                    return;
                }
                
                const userOrders = this.data.orders.filter(order => 
                    order.userId === this.data.currentUser.id && 
                    order.id.toLowerCase().includes(searchTerm)
                );
                
                const container = document.getElementById('myOrdersContainer');
                const noOrdersMsg = document.getElementById('noUserOrdersMessage');
                
                if (userOrders.length === 0) {
                    container.innerHTML = '';
                    noOrdersMsg.style.display = 'block';
                    noOrdersMsg.innerHTML = `
                        <i class="fas fa-search"></i>
                        <h3>æœªæ‰¾åˆ°ç›¸å…³è®¢å•</h3>
                        <p>æœªæ‰¾åˆ°åŒ…å«"${searchTerm}"çš„è®¢å•</p>
                    `;
                    return;
                }
                
                noOrdersMsg.style.display = 'none';
                container.innerHTML = '';
                
                userOrders.forEach(order => {
                    const orderElement = this.createUserOrderElement(order);
                    container.appendChild(orderElement);
                });
            },
            
            // æ˜¾ç¤ºå¯†ç æ¨¡æ€æ¡†
            showPasswordModal() {
                document.getElementById('passwordModal').classList.add('active');
                document.getElementById('adminPassword').focus();
            },
            
            // éªŒè¯ç®¡ç†å‘˜å¯†ç 
            verifyAdminPassword() {
                const password = document.getElementById('adminPassword').value;
                const errorMsg = document.getElementById('passwordError');
                
                if (password === this.config.adminPassword) {
                    document.getElementById('passwordModal').classList.remove('active');
                    document.getElementById('adminPassword').value = '';
                    errorMsg.style.display = 'none';
                    this.openAdminPanel();
                } else {
                    errorMsg.style.display = 'block';
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminPassword').focus();
                }
            },
            
            // æ‰“å¼€ç®¡ç†å‘˜é¢æ¿ - ä¿®å¤ç‰ˆï¼ˆå¼ºåˆ¶åˆ·æ–°æ•°æ®ï¼‰
            openAdminPanel() {
                document.getElementById('adminPanel').classList.add('active');
                document.getElementById('panelOverlay').classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // é‡ç½®æ–°è®¢å•è®¡æ•°
                this.data.newOrdersCount = 0;
                localStorage.setItem('newOrdersCount', this.data.newOrdersCount);
                this.updateOrderBadge();
                
                // å¼ºåˆ¶é‡æ–°åŠ è½½æ•°æ®
                this.forceRefreshAdminData();
            },
            
            // å¼ºåˆ¶åˆ·æ–°ç®¡ç†å‘˜æ•°æ®
            async forceRefreshAdminData() {
                try {
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    const ordersContainer = document.getElementById('ordersContainer');
                    const mealList = document.getElementById('mealList');
                    
                    if (ordersContainer) {
                        ordersContainer.innerHTML = '<div class="loading-message"><i class="fas fa-spinner fa-spin"></i><p>æ­£åœ¨åŠ è½½æœ€æ–°æ•°æ®...</p></div>';
                    }
                    
                    if (mealList) {
                        mealList.innerHTML = '<div class="loading-message"><i class="fas fa-spinner fa-spin"></i><p>æ­£åœ¨åŠ è½½å¥—é¤...</p></div>';
                    }
                    
                    // ä»äº‘ç«¯åŠ è½½æœ€æ–°æ•°æ®
                    if (this.data.isCloudAvailable) {
                        await Promise.all([
                            this.loadOrdersFromCloud().catch(e => console.error("åŠ è½½è®¢å•å¤±è´¥:", e)),
                            this.loadMealsFromCloud().catch(e => console.error("åŠ è½½å¥—é¤å¤±è´¥:", e))
                        ]);
                    }
                    
                    // æ¸²æŸ“æ•°æ®
                    const currentFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                    this.renderAdminOrders(currentFilter);
                    this.updateMealList('all');
                    
                    this.showNotification('æ•°æ®å·²åˆ·æ–°ï¼', 'success');
                } catch (error) {
                    console.error("âŒ åˆ·æ–°ç®¡ç†å‘˜æ•°æ®å¤±è´¥:", error);
                    this.showNotification('åˆ·æ–°æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜', 'warning');
                    
                    // ä½¿ç”¨æœ¬åœ°æ•°æ®æ¸²æŸ“
                    const currentFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                    this.renderAdminOrders(currentFilter);
                    this.updateMealList('all');
                }
            },
            
            // å…³é—­ç®¡ç†å‘˜é¢æ¿
            closeAdminPanel() {
                document.getElementById('adminPanel').classList.remove('active');
                document.getElementById('panelOverlay').classList.remove('active');
                document.body.style.overflow = 'auto';
            },
            
            // åˆ‡æ¢ç®¡ç†å‘˜æ ‡ç­¾é¡µ
            switchAdminTab(tabId) {
                // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`.admin-tab[data-tab="${tabId}"]`).classList.add('active');
                
                // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹
                document.querySelectorAll('.admin-tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabId}Tab`).classList.add('active');
                
                // å¦‚æœæ˜¯å¥—é¤ç®¡ç†æ ‡ç­¾ï¼Œæ›´æ–°å¥—é¤åˆ—è¡¨
                if (tabId === 'meals') {
                    this.updateMealList('all');
                }
            },
            
            // æ¸²æŸ“ç®¡ç†å‘˜è®¢å• - ä¿®å¤ç‰ˆï¼ˆç¡®ä¿çŠ¶æ€æ­£ç¡®æ˜¾ç¤ºï¼‰
            renderAdminOrders(filter = 'all') {
                const container = document.getElementById('ordersContainer');
                const noOrdersMessage = document.getElementById('noOrdersMessage');
                const loadingAdminOrders = document.getElementById('loadingAdminOrders');
                
                if (loadingAdminOrders) {
                    loadingAdminOrders.style.display = 'none';
                }
                
                let filteredOrders = this.data.orders;
                if (filter !== 'all') {
                    filteredOrders = this.data.orders.filter(order => order.status === filter);
                }
                
                if (filteredOrders.length === 0) {
                    container.innerHTML = '';
                    noOrdersMessage.style.display = 'block';
                    return;
                }
                
                noOrdersMessage.style.display = 'none';
                container.innerHTML = '';
                
                filteredOrders.forEach(order => {
                    const orderElement = this.createAdminOrderElement(order);
                    container.appendChild(orderElement);
                });
            },
            
            // åˆ›å»ºç®¡ç†å‘˜è®¢å•å…ƒç´  - ä¿®å¤ç‰ˆï¼ˆæ·»åŠ æˆªå›¾æŸ¥çœ‹å’Œä¿®å¤çŠ¶æ€æ›´æ–°ï¼‰
            createAdminOrderElement(order) {
                const orderElement = document.createElement('div');
                orderElement.className = 'admin-order-item';
                
                let statusClass, statusText;
                switch (order.status) {
                    case 'new':
                        statusClass = 'status-new';
                        statusText = 'æ–°è®¢å•';
                        break;
                    case 'processing':
                        statusClass = 'status-processing';
                        statusText = 'å¤„ç†ä¸­';
                        break;
                    case 'completed':
                        statusClass = 'status-completed';
                        statusText = 'å·²å®Œæˆ';
                        break;
                    default:
                        statusClass = 'status-new';
                        statusText = 'æ–°è®¢å•';
                }
                
                let deliveryText = '';
                let screenshotHtml = '';
                
                if (order.deliveryType === 'delivery') {
                    deliveryText = `å®…æ€¥é€ - ${order.deliveryInfo.name} - ${order.deliveryInfo.phone} - ${order.deliveryInfo.address}`;
                } else {
                    if (order.deliveryInfo.method === 'text') {
                        deliveryText = `åˆ°åº—è‡ªæ - ${order.deliveryInfo.city} - ${order.deliveryInfo.store}`;
                    } else {
                        deliveryText = `åˆ°åº—è‡ªæ - æˆªå›¾æ–¹å¼`;
                        
                        // æ·»åŠ æˆªå›¾æ˜¾ç¤ºï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                        if (order.screenshotData || order.hasScreenshot) {
                            const screenshotData = order.screenshotData || '';
                            screenshotHtml = `
                                <div style="margin-top: 10px;">
                                    <button class="view-screenshot-btn" onclick="KFCSystem.showScreenshot('${this.escapeHtml(screenshotData)}')">
                                        <i class="fas fa-image"></i>
                                        æŸ¥çœ‹é—¨åº—æˆªå›¾
                                    </button>
                                </div>
                            `;
                        }
                    }
                }
                
                // ç¡®å®šæ­£ç¡®çš„è®¢å•IDç”¨äºæ›´æ–°
                const orderIdForUpdate = order.objectId || order.id;
                
                orderElement.innerHTML = `
                    <div class="order-id">è®¢å•å·ï¼š${order.id}</div>
                    <div class="order-time">${order.timestamp}</div>
                    <div class="order-status ${statusClass}">${statusText}</div>
                    
                    <div class="order-details">
                        <p><strong>è®¢å•æ€»ä»·ï¼š</strong>Â¥${order.totalPrice.toFixed(2)}</p>
                        <p><strong>é…é€æ–¹å¼ï¼š</strong>${deliveryText}</p>
                        ${screenshotHtml}
                        ${order.orderNote ? `<p><strong>å¤‡æ³¨ï¼š</strong>${order.orderNote}</p>` : ''}
                        <p><strong>ç”¨æˆ·IDï¼š</strong>${order.userId?.substring(0, 12) || 'æœªçŸ¥ç”¨æˆ·'}...</p>
                    </div>
                    
                    <div class="order-items">
                        ${order.items.map(item => `
                            <div style="padding: 5px 0; border-bottom: 1px dashed #eee; display: flex; justify-content: space-between;">
                                <div>${item.name} Ã—${item.quantity}</div>
                                <div style="font-weight: bold; color: #e31837;">${item.price > 0 ? 'Â¥' + item.price.toFixed(2) : 'å·²åŒ…å«'}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="filter-btn" onclick="KFCSystem.updateOrderStatus('${orderIdForUpdate}', 'processing')" ${order.status === 'processing' || order.status === 'completed' ? 'disabled' : ''}>
                            <i class="fas fa-cogs"></i>
                            æ ‡è®°ä¸ºå¤„ç†ä¸­
                        </button>
                        <button class="filter-btn" onclick="KFCSystem.updateOrderStatus('${orderIdForUpdate}', 'completed')" ${order.status === 'completed' ? 'disabled' : ''}>
                            <i class="fas fa-check-circle"></i>
                            æ ‡è®°ä¸ºå·²å®Œæˆ
                        </button>
                        <button class="filter-btn" onclick="KFCSystem.deleteOrder('${orderIdForUpdate}')" style="background-color: #e31837; color: white;">
                            <i class="fas fa-trash"></i>
                            åˆ é™¤è®¢å•
                        </button>
                    </div>
                `;
                
                return orderElement;
            },
            
            // æ›´æ–°è®¢å•çŠ¶æ€ - ä¿®å¤ç‰ˆï¼ˆè§£å†³çŠ¶æ€æ›´æ–°æ˜¾ç¤ºé—®é¢˜ï¼‰
            async updateOrderStatus(orderId, newStatus) {
                console.log("ğŸ”§ å¼€å§‹æ›´æ–°è®¢å•çŠ¶æ€:", orderId, "->", newStatus);
                
                try {
                    // 1. é¦–å…ˆåœ¨æœ¬åœ°æ•°æ®ä¸­æ‰¾åˆ°è®¢å•ï¼ˆå¢å¼ºåŒ¹é…é€»è¾‘ï¼‰
                    let orderToUpdate = null;
                    let orderIndex = -1;
                    
                    // å¤šç§æ–¹å¼åŒ¹é…è®¢å•ID
                    for (let i = 0; i < this.data.orders.length; i++) {
                        const order = this.data.orders[i];
                        // æ£€æŸ¥å¤šç§å¯èƒ½çš„IDå­—æ®µ
                        if (order.objectId === orderId || 
                            order.id === orderId ||
                            (order.objectId && order.objectId.toString() === orderId.toString())) {
                            orderToUpdate = order;
                            orderIndex = i;
                            console.log("ğŸ“‹ æ‰¾åˆ°æœ¬åœ°è®¢å•:", order.id, "å½“å‰çŠ¶æ€:", order.status);
                            break;
                        }
                    }
                    
                    if (!orderToUpdate) {
                        console.error("âŒ æœ¬åœ°æœªæ‰¾åˆ°è®¢å•:", orderId);
                        this.showNotification('è®¢å•æœªæ‰¾åˆ°ï¼', 'error');
                        return;
                    }
                    
                    const oldStatus = orderToUpdate.status;
                    console.log("ğŸ”„ çŠ¶æ€å˜æ›´:", oldStatus, "->", newStatus);
                    
                    // 2. å…ˆæ›´æ–°æœ¬åœ°çŠ¶æ€ï¼ˆç«‹å³å“åº”ï¼‰
                    this.data.orders[orderIndex].status = newStatus;
                    
                    // 3. æ›´æ–°æ–°è®¢å•è®¡æ•°
                    if (oldStatus === 'new' && newStatus !== 'new') {
                        this.data.newOrdersCount = Math.max(0, this.data.newOrdersCount - 1);
                        localStorage.setItem('newOrdersCount', this.data.newOrdersCount);
                        this.updateOrderBadge();
                    }
                    
                    // 4. ç«‹å³æ›´æ–°æœ¬åœ°å­˜å‚¨ï¼ˆè®©ç”¨æˆ·çœ‹åˆ°å˜åŒ–ï¼‰
                    localStorage.setItem('kfcOrders', JSON.stringify(this.data.orders));
                    
                    // 5. åŒæ—¶æ›´æ–°äº‘ç«¯ï¼ˆåå°è¿›è¡Œï¼‰
                    let cloudUpdated = false;
                    if (this.data.isCloudAvailable && orderToUpdate.objectId) {
                        try {
                            console.log("â˜ï¸ å¼€å§‹æ›´æ–°äº‘ç«¯çŠ¶æ€...");
                            await this.updateOrderStatusOnCloud(orderToUpdate.objectId, newStatus);
                            cloudUpdated = true;
                            console.log("âœ… äº‘ç«¯æ›´æ–°æˆåŠŸ");
                        } catch (cloudError) {
                            console.error("âš ï¸ äº‘ç«¯æ›´æ–°å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ›´æ–°:", cloudError);
                            // äº‘ç«¯å¤±è´¥ä¸å½±å“æœ¬åœ°æ“ä½œ
                        }
                    }
                    
                    // 6. é‡æ–°ä»äº‘ç«¯åŠ è½½æ•°æ®ä»¥ç¡®ä¿ä¸€è‡´æ€§
                    if (this.data.isCloudAvailable && cloudUpdated) {
                        try {
                            console.log("ğŸ”„ ä»äº‘ç«¯é‡æ–°åŠ è½½è®¢å•æ•°æ®...");
                            await this.loadOrdersFromCloud();
                        } catch (reloadError) {
                            console.error("âš ï¸ é‡æ–°åŠ è½½äº‘ç«¯æ•°æ®å¤±è´¥:", reloadError);
                            // ç»§ç»­ä½¿ç”¨æœ¬åœ°æ•°æ®
                        }
                    }
                    
                    // 7. è·å–å½“å‰ç­›é€‰çŠ¶æ€å¹¶é‡æ–°æ¸²æŸ“
                    const currentFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                    console.log("ğŸ¨ é‡æ–°æ¸²æŸ“è®¢å•åˆ—è¡¨ï¼Œç­›é€‰å™¨:", currentFilter);
                    
                    // å…ˆå¼ºåˆ¶æ¸…ç©ºå®¹å™¨
                    const container = document.getElementById('ordersContainer');
                    if (container) {
                        container.innerHTML = '<div class="loading-message"><i class="fas fa-spinner fa-spin"></i><p>æ›´æ–°ä¸­...</p></div>';
                    }
                    
                    // ç­‰å¾…ä¸€å°æ®µæ—¶é—´ç¡®ä¿DOMæ›´æ–°
                    setTimeout(() => {
                        this.renderAdminOrders(currentFilter);
                        console.log("âœ… è®¢å•åˆ—è¡¨å·²é‡æ–°æ¸²æŸ“");
                    }, 100);
                    
                    // 8. åŒæ—¶æ›´æ–°ç”¨æˆ·è®¢å•é¡µé¢ï¼ˆå¦‚æœæ­£åœ¨æŸ¥çœ‹ï¼‰
                    if (document.getElementById('myOrdersPage')?.classList.contains('active')) {
                        setTimeout(() => {
                            const userFilter = document.querySelector('.order-filter-tab.active')?.dataset.orderFilter || 'all';
                            this.renderUserOrders(userFilter);
                        }, 200);
                    }
                    
                    this.showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸ºï¼š${this.getStatusText(newStatus)}`, 'success');
                    
                } catch (error) {
                    console.error("âŒ æ›´æ–°è®¢å•çŠ¶æ€å¤±è´¥:", error);
                    this.showNotification('æ›´æ–°è®¢å•çŠ¶æ€å¤±è´¥ï¼', 'error');
                    
                    // å³ä½¿å¤±è´¥ä¹Ÿå°è¯•é‡æ–°æ¸²æŸ“
                    try {
                        const currentFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                        this.renderAdminOrders(currentFilter);
                    } catch (renderError) {
                        console.error("é‡æ–°æ¸²æŸ“ä¹Ÿå¤±è´¥:", renderError);
                    }
                }
            },
            
            // è·å–çŠ¶æ€æ–‡æœ¬
            getStatusText(status) {
                const statusMap = {
                    'new': 'æ–°è®¢å•',
                    'processing': 'å¤„ç†ä¸­', 
                    'completed': 'å·²å®Œæˆ'
                };
                return statusMap[status] || status;
            },
            
            // åˆ é™¤è®¢å•
            async deleteOrder(orderId) {
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                    return;
                }
                
                try {
                    // ä»äº‘ç«¯åˆ é™¤
                    await this.deleteOrderFromCloud(orderId);
                    
                    // ä»æœ¬åœ°åˆ é™¤
                    const orderIndex = this.data.orders.findIndex(o => o.objectId === orderId || o.id === orderId);
                    if (orderIndex !== -1) {
                        // å¦‚æœæ˜¯æ–°è®¢å•ï¼Œå‡å°‘è®¡æ•°
                        if (this.data.orders[orderIndex].status === 'new') {
                            this.data.newOrdersCount = Math.max(0, this.data.newOrdersCount - 1);
                            localStorage.setItem('newOrdersCount', this.data.newOrdersCount);
                            this.updateOrderBadge();
                        }
                        
                        this.data.orders.splice(orderIndex, 1);
                        localStorage.setItem('kfcOrders', JSON.stringify(this.data.orders));
                    }
                    
                    // é‡æ–°æ¸²æŸ“è®¢å•
                    const currentFilter = document.querySelector('.filter-btn.active')?.dataset.filter;
                    this.renderAdminOrders(currentFilter || 'all');
                    
                    this.showNotification('è®¢å•å·²åˆ é™¤ï¼', 'success');
                } catch (error) {
                    console.error("âŒ åˆ é™¤è®¢å•å¤±è´¥:", error);
                    this.showNotification('åˆ é™¤è®¢å•å¤±è´¥ï¼', 'error');
                }
            },
            
            // æ¸…ç©ºæ‰€æœ‰è®¢å•
            async clearAllOrders() {
                if (this.data.orders.length === 0) {
                    this.showNotification('æ²¡æœ‰å¯æ¸…ç©ºçš„è®¢å•ï¼', 'info');
                    return;
                }
                
                if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®¢å•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    return;
                }
                
                try {
                    // æ¸…ç©ºäº‘ç«¯è®¢å•
                    await this.clearAllOrdersFromCloud();
                    
                    // æ¸…ç©ºæœ¬åœ°è®¢å•
                    this.data.orders = [];
                    this.data.newOrdersCount = 0;
                    
                    localStorage.setItem('kfcOrders', JSON.stringify([]));
                    localStorage.setItem('newOrdersCount', 0);
                    
                    this.updateOrderBadge();
                    this.renderAdminOrders('all');
                    
                    this.showNotification('å·²æ¸…ç©ºæ‰€æœ‰è®¢å•ï¼', 'success');
                } catch (error) {
                    console.error("âŒ æ¸…ç©ºæ‰€æœ‰è®¢å•å¤±è´¥:", error);
                    this.showNotification('æ¸…ç©ºè®¢å•å¤±è´¥ï¼', 'error');
                }
            },
            
            // æ›´æ–°å¥—é¤åˆ—è¡¨
            updateMealList(filter = 'all') {
                const container = document.getElementById('mealList');
                const noMealsMsg = document.getElementById('noMealsAdminMessage');
                const loadingAdminMeals = document.getElementById('loadingAdminMeals');
                
                if (loadingAdminMeals) {
                    loadingAdminMeals.style.display = 'none';
                }
                
                let filteredMeals = this.data.meals;
                if (filter === 'active') {
                    filteredMeals = this.data.meals.filter(meal => meal.active !== false);
                } else if (filter === 'inactive') {
                    filteredMeals = this.data.meals.filter(meal => meal.active === false);
                }
                
                if (filteredMeals.length === 0) {
                    container.innerHTML = '';
                    noMealsMsg.style.display = 'block';
                    return;
                }
                
                noMealsMsg.style.display = 'none';
                container.innerHTML = '';
                
                filteredMeals.forEach(meal => {
                    const mealItem = this.createMealListItem(meal);
                    container.appendChild(mealItem);
                });
            },
            
            // åˆ›å»ºå¥—é¤åˆ—è¡¨é¡¹
            createMealListItem(meal) {
                const mealItem = document.createElement('div');
                mealItem.className = 'meal-list-item';
                
                const statusHtml = meal.active === false ? 
                    '<span style="color: #f44336; font-weight: bold;">(å·²ä¸‹æ¶)</span>' : 
                    '<span style="color: #4CAF50; font-weight: bold;">(å·²ä¸Šæ¶)</span>';
                
                mealItem.innerHTML = `
                    <div class="meal-list-item-info">
                        <h4>${meal.name} ${statusHtml}</h4>
                        <p><strong>ä»·æ ¼:</strong> Â¥${meal.price} | <strong>æ ‡ç­¾:</strong> ${Array.isArray(meal.tags) ? meal.tags.join(', ') : meal.tags}</p>
                        <p><strong>æè¿°:</strong> ${meal.description}</p>
                        <p><strong>é€‰é¡¹ç»„:</strong> ${meal.optionGroups ? meal.optionGroups.length : 0} ä¸ª</p>
                    </div>
                    <div class="meal-list-item-actions">
                        <button class="action-btn edit-btn" data-meal-id="${meal.objectId || meal.id}">
                            <i class="fas fa-edit"></i> ç¼–è¾‘
                        </button>
                        <button class="action-btn delete-btn" data-meal-id="${meal.objectId || meal.id}">
                            <i class="fas fa-trash"></i> åˆ é™¤
                        </button>
                    </div>
                `;
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬
                const editBtn = mealItem.querySelector('.edit-btn');
                const deleteBtn = mealItem.querySelector('.delete-btn');
                
                editBtn.addEventListener('click', () => {
                    this.editMeal(meal.objectId || meal.id);
                });
                
                deleteBtn.addEventListener('click', () => {
                    this.deleteMeal(meal.objectId || meal.id);
                });
                
                return mealItem;
            },
            
            // ç¼–è¾‘å¥—é¤
            editMeal(mealId) {
                const meal = this.data.meals.find(m => (m.objectId === mealId) || (m.id === mealId));
                if (!meal) return;
                
                this.data.editingMeal = meal;
                
                // åˆ‡æ¢åˆ°æ·»åŠ å¥—é¤æ ‡ç­¾é¡µ
                this.switchAdminTab('addMeal');
                
                // æ›´æ–°è¡¨å•æ ‡é¢˜
                document.getElementById('addMealTitle').innerHTML = `
                    <i class="fas fa-edit"></i>
                    ç¼–è¾‘å¥—é¤
                `;
                
                // å¡«å……è¡¨å•æ•°æ®
                document.getElementById('currentMealId').value = meal.objectId || meal.id;
                document.getElementById('mealName').value = meal.name;
                document.getElementById('mealPrice').value = meal.price;
                document.getElementById('mealTags').value = Array.isArray(meal.tags) ? meal.tags.join(',') : meal.tags;
                document.getElementById('mealDescription').value = meal.description;
                document.getElementById('mealActive').checked = meal.active !== false;
                document.getElementById('statusText').textContent = meal.active !== false ? 'ä¸Šæ¶' : 'ä¸‹æ¶';
                document.getElementById('statusText').className = meal.active !== false ? 'status-active' : 'status-inactive';
                
                // æ˜¾ç¤ºå–æ¶ˆç¼–è¾‘æŒ‰é’®
                document.getElementById('cancelEditBtn').style.display = 'block';
            },
            
            // åˆ é™¤å¥—é¤
            async deleteMeal(mealId) {
                const meal = this.data.meals.find(m => (m.objectId === mealId) || (m.id === mealId));
                if (!meal) return;
                
                if (!confirm(`ç¡®å®šè¦åˆ é™¤å¥—é¤ "${meal.name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                    return;
                }
                
                try {
                    // ä»äº‘ç«¯åˆ é™¤
                    await this.deleteMealFromCloud(mealId);
                    
                    // ä»æœ¬åœ°åˆ é™¤
                    const mealIndex = this.data.meals.findIndex(m => (m.objectId === mealId) || (m.id === mealId));
                    if (mealIndex !== -1) {
                        this.data.meals.splice(mealIndex, 1);
                        this.saveMealsToLocal();
                    }
                    
                    // æ›´æ–°æ˜¾ç¤º
                    this.updateHomePage();
                    this.updateMealList('all');
                    
                    this.showNotification('å¥—é¤å·²åˆ é™¤ï¼', 'success');
                } catch (error) {
                    console.error("âŒ åˆ é™¤å¥—é¤å¤±è´¥:", error);
                    this.showNotification('åˆ é™¤å¥—é¤å¤±è´¥ï¼', 'error');
                }
            },
            
            // ä¿å­˜å¥—é¤
            async saveMeal() {
                const mealName = document.getElementById('mealName').value.trim();
                const mealPrice = parseFloat(document.getElementById('mealPrice').value);
                const mealTags = document.getElementById('mealTags').value.trim().split(',').map(tag => tag.trim());
                const mealDescription = document.getElementById('mealDescription').value.trim();
                const mealActive = document.getElementById('mealActive').checked;
                const currentMealId = document.getElementById('currentMealId').value;
                
                if (!mealName || isNaN(mealPrice) || !mealTags.length || !mealDescription) {
                    this.showNotification('è¯·å¡«å†™å®Œæ•´çš„å¥—é¤ä¿¡æ¯ï¼', 'error');
                    return;
                }
                
                try {
                    let mealData;
                    
                    if (this.data.editingMeal) {
                        // æ›´æ–°ç°æœ‰å¥—é¤ï¼Œä¿ç•™åŸæœ‰çš„optionGroupså’ŒfixedItems
                        mealData = {
                            ...this.data.editingMeal,
                            name: mealName,
                            price: mealPrice,
                            tags: mealTags,
                            description: mealDescription,
                            active: mealActive,
                            // ä¿ç•™åŸæœ‰çš„optionGroupså’ŒfixedItems
                            optionGroups: this.data.editingMeal.optionGroups || [],
                            fixedItems: this.data.editingMeal.fixedItems || [],
                            updatedAt: new Date().toISOString()
                        };
                    } else {
                        // åˆ›å»ºæ–°å¥—é¤
                        mealData = {
                            id: 'meal_' + Date.now(),
                            objectId: null,
                            name: mealName,
                            price: mealPrice,
                            tags: mealTags,
                            description: mealDescription,
                            active: mealActive,
                            optionGroups: [],
                            fixedItems: [],
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        };
                    }
                    
                    // ä¿å­˜åˆ°äº‘ç«¯
                    const savedMeal = await this.saveMealToCloud(mealData);
                    
                    // æ›´æ–°æœ¬åœ°æ•°æ®
                    if (this.data.editingMeal) {
                        const mealIndex = this.data.meals.findIndex(m => m.objectId === currentMealId);
                        if (mealIndex !== -1) {
                            this.data.meals[mealIndex] = savedMeal;
                        }
                    } else {
                        this.data.meals.push(savedMeal);
                    }
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    this.saveMealsToLocal();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    this.showNotification(`å¥—é¤${this.data.editingMeal ? 'æ›´æ–°' : 'æ·»åŠ '}æˆåŠŸï¼`, 'success');
                    
                    // é‡ç½®è¡¨å•
                    this.resetMealForm();
                    
                    // æ›´æ–°æ˜¾ç¤º
                    this.updateHomePage();
                    this.updateMealList('all');
                    
                    // åˆ‡æ¢åˆ°å¥—é¤ç®¡ç†æ ‡ç­¾é¡µ
                    this.switchAdminTab('meals');
                    
                } catch (error) {
                    console.error("âŒ ä¿å­˜å¥—é¤å¤±è´¥:", error);
                    this.showNotification('ä¿å­˜å¥—é¤å¤±è´¥ï¼', 'error');
                }
            },
            
            // å–æ¶ˆç¼–è¾‘å¥—é¤
            cancelEditMeal() {
                this.data.editingMeal = null;
                this.resetMealForm();
                
                // åˆ‡æ¢åˆ°å¥—é¤ç®¡ç†æ ‡ç­¾é¡µ
                this.switchAdminTab('meals');
            },
            
            // é‡ç½®å¥—é¤è¡¨å•
            resetMealForm() {
                document.getElementById('currentMealId').value = '';
                document.getElementById('mealName').value = '';
                document.getElementById('mealPrice').value = '';
                document.getElementById('mealTags').value = '';
                document.getElementById('mealDescription').value = '';
                document.getElementById('mealActive').checked = true;
                document.getElementById('statusText').textContent = 'ä¸Šæ¶';
                document.getElementById('statusText').className = 'status-active';
                document.getElementById('addMealTitle').innerHTML = `
                    <i class="fas fa-plus-circle"></i>
                    æ·»åŠ æ–°å¥—é¤
                `;
                document.getElementById('cancelEditBtn').style.display = 'none';
            },
            
            // æ›´æ–°æ–°è®¢å•å¾½ç« 
            updateOrderBadge() {
                const badge = document.getElementById('newOrderBadge');
                if (this.data.newOrdersCount > 0) {
                    badge.textContent = this.data.newOrdersCount > 9 ? '9+' : this.data.newOrdersCount;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            },
            
            // æ˜¾ç¤ºæˆªå›¾æ¨¡æ€æ¡†
            showScreenshot(imageData) {
                if (!imageData || imageData === '') {
                    this.showNotification('æˆªå›¾æ•°æ®ä¸ºç©ºï¼', 'error');
                    return;
                }
                
                // è®¾ç½®å›¾ç‰‡
                const img = document.getElementById('screenshotImage');
                if (img) {
                    img.src = imageData;
                }
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                const modal = document.getElementById('screenshotModal');
                modal.classList.add('active');
                document.body.style.overflow = 'hidden'; // é˜²æ­¢æ»šåŠ¨
            },
            
            // å…³é—­æˆªå›¾æ¨¡æ€æ¡†
            closeScreenshot() {
                const modal = document.getElementById('screenshotModal');
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            },
            
            // ä¸‹è½½æˆªå›¾
            downloadScreenshot() {
                const img = document.getElementById('screenshotImage');
                if (!img || !img.src) {
                    this.showNotification('æ²¡æœ‰å¯ä¸‹è½½çš„æˆªå›¾ï¼', 'error');
                    return;
                }
                
                const link = document.createElement('a');
                link.href = img.src;
                link.download = `é—¨åº—æˆªå›¾_${new Date().getTime()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('æˆªå›¾ä¸‹è½½ä¸­...', 'success');
            },
            
            // HTMLè½¬ä¹‰å‡½æ•°
            escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, function(m) { return map[m]; });
            },
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(message, type = 'success') {
                // åˆ›å»ºé€šçŸ¥å…ƒç´ 
                const notification = document.createElement('div');
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background-color: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#e31837' : type === 'warning' ? '#ff9800' : '#e31837'};
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    z-index: 10000;
                    font-weight: bold;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    animation: slideIn 0.3s ease;
                    max-width: 400px;
                    word-break: break-word;
                `;
                
                document.body.appendChild(notification);
                
                // æ·»åŠ CSSåŠ¨ç”»
                if (!document.getElementById('notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideIn {
                            from {
                                transform: translateX(100%);
                                opacity: 0;
                            }
                            to {
                                transform: translateX(0);
                                opacity: 1;
                            }
                        }
                        
                        @keyframes slideOut {
                            from {
                                transform: translateX(0);
                                opacity: 1;
                            }
                            to {
                                transform: translateX(100%);
                                opacity: 0;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // 3ç§’åç§»é™¤é€šçŸ¥
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ç³»ç»Ÿ
        document.addEventListener('DOMContentLoaded', function() {
            KFCSystem.init();
            
            // å°†KFCSystemæš´éœ²ç»™å…¨å±€ä½œç”¨åŸŸï¼Œç”¨äºonclickäº‹ä»¶
            window.KFCSystem = KFCSystem;
        });
    </script>
</body>
</html>
